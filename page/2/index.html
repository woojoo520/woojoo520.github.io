<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="a study blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Celery Fairy">
<meta property="og:url" content="https://woojoo520.github.io/page/2/index.html">
<meta property="og:site_name" content="Celery Fairy">
<meta property="og:description" content="a study blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Celery Fairy">
<meta name="twitter:description" content="a study blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://woojoo520.github.io/page/2/">





  <title>Celery Fairy</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <a href="https://github.com/woojoo520" class="github-corner" aria-label="View source on GitHub">
      <svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/>
      </svg>
    </a>
    <style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Celery Fairy</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Celery's Blog</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://woojoo520.github.io/2019/11/13/初识LaTex/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mariana">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Celery Fairy">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/13/初识LaTex/" itemprop="url">初识LaTex</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-11-13T14:30:53+08:00">
                2019-11-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="基本内容"><a href="#基本内容" class="headerlink" title="基本内容"></a>基本内容</h3><ul>
<li>LaTeX的基本语法</li>
<li>完成一篇LaTeX创建的简单论文</li>
</ul>
<h3 id="LaTeX的基本语法"><a href="#LaTeX的基本语法" class="headerlink" title="LaTeX的基本语法"></a>LaTeX的基本语法</h3><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">\<span class="name">documentclass</span><span class="string">[UTF8]</span><span class="string">&#123;ctexart&#125;</span></span>	<span class="comment">% 使用中文版的artical文档类型排版，并选择UTF8编码格式</span></span><br><span class="line"><span class="tag">\<span class="name">usepackage</span><span class="string">&#123;amsmath&#125;</span></span>	<span class="comment">% 使用宏包，这里使用的是调用公式宏包，可以调用多个宏包</span></span><br><span class="line"><span class="tag">\<span class="name">begin</span><span class="string">&#123;document&#125;</span></span>	<span class="comment">% 开始写文章</span></span><br><span class="line">文章内容</span><br><span class="line"><span class="tag">\<span class="name">end</span><span class="string">&#123;document&#125;</span></span>	<span class="comment">% 结束写文章</span></span><br></pre></td></tr></table></figure>

<p>以上就是完成一篇LaTeX文档的基本格式。LaTeX是使用各种各样的命令来操作文档格式以及文档内容的。</p>
<h3 id="标准文类"><a href="#标准文类" class="headerlink" title="标准文类"></a>标准文类</h3><ul>
<li><code>artical</code>：短文，评论，学术论文；无左右页区分，无章设置。对应中文类ctexart</li>
<li><code>book</code>：著作，学位论文；默认有左右页区分，章起右页，对应中文类ctexbook</li>
<li><code>report</code>：商业，科技，实验报告，默认无左右页区分，章起新页。对应中文类：ctexrep</li>
<li><code>beamer</code>：论文陈述幻灯片；提供多种主题式样，可方便更改幻灯片的整体风格</li>
</ul>
<h3 id="常用宏包"><a href="#常用宏包" class="headerlink" title="常用宏包"></a>常用宏包</h3><ul>
<li><p>amsmath 公式环境和数学命令 </p>
</li>
<li><p>amssymb 数学符号生成命令 </p>
</li>
<li><p>array 数组和表格制作 </p>
</li>
<li><p>calc 四则运算 </p>
</li>
<li><p>caption 插图和表格标题格式设置 </p>
</li>
<li><p>fancyhdr 页眉页脚设置 </p>
</li>
<li><p>fancyvrb 抄录格式设置 </p>
</li>
<li><p>fontspec 字体选择 </p>
</li>
<li><p>geometry 版面尺寸设置 </p>
</li>
<li><p>graphicx 插图处理 </p>
</li>
<li><p>hyperref 创建超文本链接和PDF书签 </p>
</li>
<li><p>longtable 制作跨页表格 </p>
</li>
<li><p>multicol 多栏排版 </p>
</li>
<li><p>ntheorem 定理设置 </p>
</li>
<li><p>paralist 多种列表环境 </p>
</li>
<li><p>tabularx 自动设置表格列宽 </p>
</li>
<li><p>titlesec 章节标题格式设置 </p>
</li>
<li><p>titletoc 目录格式设置 </p>
</li>
<li><p>xcolor 颜色处理 </p>
</li>
<li><p>xeCJK 中日朝文字处理和字体选择</p>
</li>
</ul>
<h3 id="完成一篇简单的论文"><a href="#完成一篇简单的论文" class="headerlink" title="完成一篇简单的论文"></a>完成一篇简单的论文</h3><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">\<span class="name">documentclass</span><span class="string">[UTF8]</span><span class="string">&#123;ctexart&#125;</span></span>	<span class="comment">% 使用中文版的artical文档类型排版，并选择UTF8编码格式</span></span><br><span class="line"><span class="tag">\<span class="name">usepackage</span><span class="string">&#123;amsmath&#125;</span></span>	<span class="comment">% 使用宏包，这里使用的是调用公式宏包，可以调用多个宏包</span></span><br><span class="line"><span class="tag">\<span class="name">begin</span><span class="string">&#123;document&#125;</span></span>	<span class="comment">% 开始写文章</span></span><br><span class="line">文章内容</span><br><span class="line"><span class="tag">\<span class="name">end</span><span class="string">&#123;document&#125;</span></span>	<span class="comment">% 结束写文章</span></span><br></pre></td></tr></table></figure>

<ul>
<li>设置作者名字，论文名字以及创作时间</li>
</ul>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">\<span class="name">title</span><span class="string">&#123;杂谈关于爱情&#125;</span></span> <span class="comment">% 大括号例填写标题</span></span><br><span class="line"><span class="tag">\<span class="name">author</span><span class="string">&#123;张三&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">date</span><span class="string">&#123;\today&#125;</span></span>	<span class="comment">% 大括号里填写\today会自动生成当前的日期</span></span><br><span class="line"><span class="tag">\<span class="name">maketitle</span></span>	<span class="comment">% 写了以上内容之后一定要添加这个，制作标题，否则上面的内容都是无效的</span></span><br></pre></td></tr></table></figure>

<p>组合上述两块以内容：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">\<span class="name">documentclass</span><span class="string">[UTF8]</span><span class="string">&#123;ctexart&#125;</span></span>	<span class="comment">% 使用中文版的artical文档类型排版，并选择UTF8编码格式</span></span><br><span class="line"><span class="tag">\<span class="name">usepackage</span><span class="string">&#123;amsmath&#125;</span></span>	<span class="comment">% 使用宏包，这里使用的是调用公式宏包，可以调用多个宏包</span></span><br><span class="line"><span class="tag">\<span class="name">begin</span><span class="string">&#123;document&#125;</span></span>	<span class="comment">% 开始写文章</span></span><br><span class="line"><span class="tag">\<span class="name">title</span><span class="string">&#123;杂谈LaTex&#125;</span></span> <span class="comment">% 大括号例填写标题</span></span><br><span class="line"><span class="tag">\<span class="name">author</span><span class="string">&#123;张三&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">date</span><span class="string">&#123;\today&#125;</span></span>	<span class="comment">% 大括号里填写\today会自动生成当前的日期</span></span><br><span class="line"><span class="tag">\<span class="name">maketitle</span></span>	<span class="comment">% 写了以上内容之后一定要添加这个，制作标题，否则上面的内容都是无效的</span></span><br><span class="line"><span class="tag">\<span class="name">end</span><span class="string">&#123;document&#125;</span></span>	<span class="comment">% 结束写文章</span></span><br></pre></td></tr></table></figure>

<p>也可以将姓名标题填到<code>\begin{document}</code>的上面，将<code>\maketitle</code>放在<code>\begin{document}</code>的下面，效果也是一样的</p>
<ul>
<li>添加摘要部分</li>
</ul>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">\<span class="name">begin</span><span class="string">&#123;abstract&#125;</span></span>	<span class="comment">% 摘要部分</span></span><br><span class="line"><span class="tag">\<span class="name">small</span></span><span class="tag">\<span class="name">centering</span></span>这是一篇关于MYQ爱情史的小论文。&amp;<span class="tag">\<span class="name">small</span></span>是使用缩小字体，<span class="tag">\<span class="name">centering</span></span>是使内容居中</span><br><span class="line"><span class="tag">\<span class="name">end</span><span class="string">&#123;abstract&#125;</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>添加目录</li>
</ul>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">\<span class="name">tableofcontents</span></span>	<span class="comment">% 表示目录部分的开始</span></span><br><span class="line"><span class="tag">\<span class="name">section</span><span class="string">&#123;萌芽&#125;</span></span>	<span class="comment">% 目录的前缀页面都会自动排版不需要手动排版</span></span><br><span class="line"><span class="tag">\<span class="name">section</span><span class="string">&#123;发展&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">addcontentsline</span><span class="string">&#123;toc&#125;</span><span class="string">&#123;section&#125;</span><span class="string">&#123;参考文献&#125;</span></span>	<span class="comment">% 用来添加文献的标准方式</span></span><br><span class="line"><span class="tag">\<span class="name">section</span><span class="string">&#123;附录&#125;</span></span>	<span class="comment">% 要写的附录</span></span><br></pre></td></tr></table></figure>

<ul>
<li>填写每一个小结的内容</li>
</ul>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">\<span class="name">usepackage</span><span class="string">&#123;graphicx&#125;</span></span>	<span class="comment">% 先添加宏包插图，方便接下来添加图片</span></span><br><span class="line"><span class="tag">\<span class="name">label</span><span class="string">&#123;sec:ancient&#125;</span></span>		<span class="comment">% 这是添加书签的命令，一会儿要用到</span></span><br><span class="line"><span class="tag">\<span class="name">small</span></span> MYQ<span class="tag">\<span class="name">footnote</span><span class="string">&#123;MYQ，北京邮电大学学生&#125;</span></span>是一个没有谈过恋爱的小仙女<span class="tag">\<span class="name">cite</span><span class="string">&#123;Kline&#125;</span></span>	<span class="comment">% 这里的cite&#123;Kline&#125;是为了一会儿添加文献标记用的，\footnote是在文章下面自动添加注释的命令，换行可以使用空一行的方法</span></span><br><span class="line"><span class="tag">\<span class="name">small</span></span> YJZ<span class="tag">\<span class="name">footnote</span><span class="string">&#123;YJZ, 北京邮电大学学生&#125;</span></span>是一个有过恋爱经历的傻子</span><br><span class="line"><span class="tag">\<span class="name">small</span></span> 他们的官宣是这样子的 <span class="tag">\<span class="name">ref</span><span class="string">&#123;fig:xiantu&#125;</span></span> 是令人非常羡慕的一对哈哈哈哈<span class="tag">\<span class="name">cite</span><span class="string">&#123;quanjing&#125;</span></span>	<span class="comment">% \ref&#123;fig:xiantu&#125;用于读取标签xiantu,cite用于引用参考文献quanjing</span></span><br><span class="line"><span class="tag">\<span class="name">begin</span><span class="string">&#123;figure&#125;</span><span class="string">[!ht]</span></span><span class="tag">\<span class="name">centering</span></span> 	<span class="comment">% 添加图片，图片文件名为xiantu.jpg</span></span><br><span class="line"><span class="tag">\<span class="name">includegraphics</span><span class="string">[scale=0.5]</span><span class="string">&#123;xiantu.jpg&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">caption</span><span class="string">&#123;这是他们两个的官宣之作\label&#123;fig:xiantu&#125;</span></span>&#125;	<span class="comment">% 在图片下面的文字说明</span></span><br><span class="line"><span class="tag">\<span class="name">end</span><span class="string">&#123;figure&#125;</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>编写第二节</li>
</ul>
<p>要在最开始添加</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">\<span class="name">usepacka</span></span> ge&#123;amsmath&#125;	</span><br><span class="line"><span class="tag">\<span class="name">newtheorem</span><span class="string">&#123;thm&#125;</span><span class="string">&#123;定理&#125;</span></span>	<span class="comment">% 定义标题为定理的定理类环境thm</span></span><br><span class="line"><span class="tag">\<span class="name">newcommand</span></span><span class="tag">\<span class="name">degree</span><span class="string">&#123;^\circ&#125;</span></span>	<span class="comment">% 定义新命令degree</span></span><br></pre></td></tr></table></figure>

<p>正文部分</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">\<span class="name">begin</span><span class="string">&#123;thm&#125;</span><span class="string">[\small爱情故事]</span></span>	<span class="comment">% 开始定理环境</span></span><br><span class="line"><span class="tag">\<span class="name">small</span></span> 他们的故事开始于北邮沙河图书馆</span><br><span class="line"><span class="tag">\<span class="name">small</span></span> 开始于矩阵论，就是<span class="formula">$A=B-C^T, C = B^T$</span>(随便写写)，进一步于概率论</span><br><span class="line"><span class="tag">\<span class="name">begin</span><span class="string">&#123;equation&#125;</span></span><span class="tag">\<span class="name">label</span><span class="string">&#123;eq:gougu&#125;</span></span>	<span class="comment">% 开始的单行公式环境equation，并添加了书签gougu </span></span><br><span class="line"><span class="tag">\<span class="name">small</span></span> 1 + 1 &gt; 2</span><br><span class="line"><span class="tag">\<span class="name">end</span><span class="string">&#123;equation&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">end</span><span class="string">&#123;thm&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">small</span></span> 满足 <span class="tag">\<span class="name">eqref</span><span class="string">&#123;eq: gougu&#125;</span></span> 的是<span class="tag">\<span class="name">emph</span><span class="string">&#123;我们&#125;</span></span>。<span class="tag">\<span class="name">ref</span><span class="string">&#123;sec:萌芽&#125;</span></span>所说的就是他们的开始。下面给出一些他们的经历；<span class="comment">% \eqref&#123;eq:gougu&#125;读入书签gougu, emph强调我们，ref读入书签 萌芽</span></span><br><span class="line"></span><br><span class="line"><span class="tag">\<span class="name">vsapce</span><span class="string">&#123;3mm&#125;</span></span>	<span class="comment">% 空一行</span></span><br><span class="line"><span class="tag">\<span class="name">begin</span><span class="string">&#123;tabular&#125;</span><span class="string">&#123;|c|c|c|&#125;</span></span><span class="tag">\<span class="name">hline</span></span>	<span class="comment">% 开始表格环境&#123;|c|c|c&#125;表示文字居中的三列. \hline...\hline表述画两条并排的水平线。\hline必须用于首行之前或者换行命令之后</span></span><br><span class="line"><span class="tag">\<span class="name">small</span></span> 时间&amp;事件&amp;好感度<span class="tag">\<span class="name">\</span></span><span class="tag">\<span class="name">hline</span></span>	<span class="comment">% &amp;是数据分割符号</span></span><br><span class="line">2019.1.24&amp;在一起&amp;100<span class="tag">\<span class="name">\</span></span><span class="tag">\<span class="name">hline</span></span></span><br><span class="line">2019.2.14&amp;第一次过情人节&amp;120<span class="tag">\<span class="name">\</span></span><span class="tag">\<span class="name">hline</span></span></span><br><span class="line">2019.5.4&amp;大傻过生日&amp;200<span class="tag">\<span class="name">\</span></span><span class="tag">\<span class="name">hline</span></span></span><br><span class="line"><span class="tag">\<span class="name">end</span><span class="string">&#123;tabular&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">small</span><span class="string">&#123;heart❤&#125;</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>书写附录和文献</li>
</ul>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">\<span class="name">begin</span><span class="string">&#123;thebibliography&#125;</span><span class="string">&#123;99&#125;</span></span>	<span class="comment">% 参考文献开始</span></span><br><span class="line"><span class="tag">\<span class="name">bibitem</span><span class="string">&#123;1&#125;</span></span>	孟烨青.有名的爱情史.北京邮电大学,2019.</span><br><span class="line"><span class="tag">\<span class="name">bibitem</span><span class="string">&#123;quanjing&#125;</span></span> 于珺泽.爱吃醋的同学.北京邮电大学,2019</span><br><span class="line"><span class="tag">\<span class="name">bibitem</span><span class="string">&#123;Kline&#125;</span></span> 助攻.没有.2019</span><br><span class="line"><span class="tag">\<span class="name">end</span><span class="string">&#123;thebibliography&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">addcontentsline</span><span class="string">&#123;toc&#125;</span><span class="string">&#123;section&#125;</span><span class="string">&#123;参考文献&#125;</span></span></span><br><span class="line"><span class="tag">\<span class="name">begin</span><span class="string">&#123;appendix&#125;</span></span>	<span class="comment">% 附录开始</span></span><br><span class="line"><span class="tag">\<span class="name">small</span></span> 今天是他们在一起的293天，大火花的第351天</span><br><span class="line"><span class="tag">\<span class="name">end</span><span class="string">&#123;appendix&#125;</span></span></span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://woojoo520.github.io/2019/11/04/semaphore/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mariana">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Celery Fairy">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/11/04/semaphore/" itemprop="url">semaphore</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-11-04T21:24:14+08:00">
                2019-11-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="信号量编程-模板"><a href="#信号量编程-模板" class="headerlink" title="信号量编程(模板)"></a>信号量编程(模板)</h2><ul>
<li><p>试解释为什么在单处理器系统的用户进程中通过屏蔽中断来实现同步是不合理的？</p>
<p>如果用户进程具有屏蔽中断的功能，那么它可以同样屏蔽计时器，没有时钟中断则分派程序无法进行，进程会无限执行</p>
</li>
<li><p>试解释为什么在多处理器系统中无法通过屏蔽中断来实现同步</p>
<p>屏蔽中断仅仅阻止其他进程在被屏蔽了中断的处理器上运行，其他进程可能在其他处理器上运行。</p>
</li>
</ul>
<p>先记住<code>wait()</code>和<code>signal()</code>的定义</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">wait(semaphore *S) &#123;</span><br><span class="line">	S-&gt;value--;</span><br><span class="line">	<span class="keyword">if</span>(S-&gt;value &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        add <span class="keyword">this</span> process to S-&gt;<span class="built_in">list</span>;</span><br><span class="line">        block();</span><br><span class="line">    &#125;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">signal(semaphore *S) &#123;</span><br><span class="line">    S-&gt;value++;</span><br><span class="line">    <span class="keyword">if</span>(S-&gt;value &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        remove a process P from S-&gt;<span class="built_in">list</span>;</span><br><span class="line">        wakeup(P);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="经典同步问题"><a href="#经典同步问题" class="headerlink" title="经典同步问题"></a>经典同步问题</h3><h4 id="有限缓冲区——生产者、消费者问题"><a href="#有限缓冲区——生产者、消费者问题" class="headerlink" title="有限缓冲区——生产者、消费者问题"></a>有限缓冲区——生产者、消费者问题</h4><ul>
<li><strong>进程互斥</strong>中的生产者-消费者问题可以通过三个信号量解决<ul>
<li>二进制信号量<code>mutex</code>保证了对缓冲区访问的互斥</li>
<li>计数信号量<code>empty</code>和<code>full</code>表示缓冲区中空余数量和已有数据数量</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// procuder</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">// produce an item</span></span><br><span class="line">    wait(empty);</span><br><span class="line">    wait(mutex);</span><br><span class="line">    <span class="comment">// put item into buffer</span></span><br><span class="line">    signal(mutex);</span><br><span class="line">    signal(empty);</span><br><span class="line">&#125; <span class="keyword">while</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// customer </span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    wait(full);</span><br><span class="line">    wait(mutex);</span><br><span class="line">    <span class="comment">// remove an item from buffer</span></span><br><span class="line">    signal(mutex);</span><br><span class="line">    signal(empty);</span><br><span class="line">&#125; <span class="keyword">while</span>(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h4 id="读者-写者问题"><a href="#读者-写者问题" class="headerlink" title="读者-写者问题"></a>读者-写者问题</h4><ul>
<li>读者优先，如果当前获得数据库权限的是读者进程，则其他读者进程无需等待，读者进程只有在当前操作数据库的进程是写者的情况下才需要阻塞</li>
<li>写者有限，任何在等待获取数据库权限的写者进程都将比其他正在等待的读者进程先获得权限</li>
<li>前两种策略回到这写者或者读者饿死的情况，第三种策略保证没有任何进程会被无限阻塞</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读者优先</span></span><br><span class="line">semaphore mutex, wrt;</span><br><span class="line"><span class="keyword">int</span> readcount;</span><br><span class="line"><span class="comment">// 读者进程</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    wait(mutex);</span><br><span class="line">    readcount++;</span><br><span class="line">    <span class="keyword">if</span>(readcount == <span class="number">1</span>) &#123;</span><br><span class="line">        wait(wrt);</span><br><span class="line">    &#125;</span><br><span class="line">    signal(mutex);</span><br><span class="line">    <span class="comment">// 读者访问</span></span><br><span class="line">    wait(mutex);</span><br><span class="line">    readcount--;</span><br><span class="line">    <span class="keyword">if</span>(readcount == <span class="number">0</span>) &#123;</span><br><span class="line">        signal(wrt);</span><br><span class="line">    &#125;</span><br><span class="line">    signal(mutex);</span><br><span class="line">&#125; <span class="keyword">while</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">// 写者</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    wait(wrt);</span><br><span class="line">    <span class="comment">// 执行写操作</span></span><br><span class="line">    signal(wrt);</span><br><span class="line">&#125; <span class="keyword">while</span>(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<p>读写公平</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;			<span class="comment">// 用于记录当前的读者数量</span></span><br><span class="line">semaphore mutex = <span class="number">1</span>;	<span class="comment">// 用于保护更新count变量时的互斥</span></span><br><span class="line">semaphore rw = <span class="number">1</span>;		<span class="comment">// 用于保证读者和写者互斥地访问文件</span></span><br><span class="line">semaphore w = <span class="number">1</span>;		<span class="comment">// 用于实现"写优先" </span></span><br><span class="line"><span class="comment">// 读者</span></span><br><span class="line">wait(w)</span><br><span class="line">wait(mutex);</span><br><span class="line">count++;</span><br><span class="line"><span class="keyword">if</span>(count == <span class="number">0</span>) &#123;</span><br><span class="line">  	wait(rw); </span><br><span class="line">&#125;</span><br><span class="line">signal(mutex);</span><br><span class="line">signal(w);</span><br><span class="line">reading;</span><br><span class="line">wait(mutex);</span><br><span class="line">count--;</span><br><span class="line"><span class="keyword">if</span>(count == <span class="number">0</span>) &#123;</span><br><span class="line">    signal(rw);</span><br><span class="line">&#125;</span><br><span class="line">signal(mutex);</span><br><span class="line"><span class="comment">// 写者</span></span><br><span class="line">wait(w);</span><br><span class="line">wait(rw);</span><br><span class="line">writing;</span><br><span class="line">signal(rw);</span><br><span class="line">signal(w);</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 写者有限</span></span><br><span class="line"><span class="keyword">int</span> readcount = <span class="number">0</span>, writecount = <span class="number">0</span>;	<span class="comment">// readcount记录当前正在等待读对象的读者数量，writecount记录当前正在等待写对象的写者数量，均初始化为0</span></span><br><span class="line">semaphore rmutex = <span class="number">1</span>, wmutex = <span class="number">1</span>;	<span class="comment">// 确保更新变量readcount和writecount时的互斥，均初始化为1</span></span><br><span class="line">semaphore readTry;	<span class="comment">// readTry信号量用于声明有读者加入等待队列，确保读者和写者之间的互斥</span></span><br><span class="line">remaphore resource; <span class="comment">//	resource信号量用于确保写者和写者之间的互斥</span></span><br><span class="line"><span class="comment">// 读者</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    wait(readTry);</span><br><span class="line">    wait(rmutex);</span><br><span class="line">    readcount++;</span><br><span class="line">    <span class="keyword">if</span>(readcount == <span class="number">1</span>) &#123;</span><br><span class="line">        wait(resource);	<span class="comment">// 第一个读者需要获取资源权限</span></span><br><span class="line">    &#125;</span><br><span class="line">    signal(rmutex);</span><br><span class="line">    signal(readTry);</span><br><span class="line">    <span class="comment">// 临界区</span></span><br><span class="line">    wait(rmutex);</span><br><span class="line">    readcount--;</span><br><span class="line">    <span class="keyword">if</span>(readcount == <span class="number">0</span>) &#123;</span><br><span class="line">        signal(resource);</span><br><span class="line">    &#125;</span><br><span class="line">    signal(rmutex);</span><br><span class="line">&#125; <span class="keyword">while</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写者</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    wait(wmutex);</span><br><span class="line">    writecount++;</span><br><span class="line">    <span class="keyword">if</span>(writecount == <span class="number">1</span>) &#123;	<span class="comment">// 第一个写者需要与读者竞争资源</span></span><br><span class="line">        wait(readTry);</span><br><span class="line">    &#125;</span><br><span class="line">    signal(wmutex);</span><br><span class="line">    <span class="comment">// 进入临界区</span></span><br><span class="line">    wait(resource);</span><br><span class="line">    <span class="comment">// 写操作</span></span><br><span class="line">    signal(resource);</span><br><span class="line">    <span class="comment">// 离开临界区</span></span><br><span class="line">    wait(wmutex);</span><br><span class="line">    writecount--;</span><br><span class="line">    <span class="keyword">if</span>(writecount == <span class="number">0</span>) &#123;</span><br><span class="line">        signal(readTry);</span><br><span class="line">    &#125;</span><br><span class="line">    signal(wmutex);</span><br><span class="line">&#125; <span class="keyword">while</span>(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h3 id="哲学家就餐问题"><a href="#哲学家就餐问题" class="headerlink" title="哲学家就餐问题"></a>哲学家就餐问题</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> &#123;thinking, hungry, eating&#125; state[<span class="number">5</span>];	<span class="comment">// 记录每个人的状态</span></span><br><span class="line">semaphore mutex = <span class="number">1</span>;	<span class="comment">// 临界区互斥，保证每个时刻最多只能有一个人执行从餐桌上取或者放两把叉子的动作</span></span><br><span class="line">semaphore self[<span class="number">5</span>] = &#123;<span class="number">0</span>&#125;;	<span class="comment">// 哲学家信号量，表明i是否已经获得2把刀叉并可以开始进餐</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">philosophere</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">        thinking();	<span class="comment">// 剩余段，思考</span></span><br><span class="line">        pickup(i);	<span class="comment">// 进入段，同时获取两把叉子或阻塞</span></span><br><span class="line">        eating();	<span class="comment">// 临界段：进餐</span></span><br><span class="line">        putdown(i);	<span class="comment">// 退出段，放下两把叉子   </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pickup</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    wait(mutex);	<span class="comment">// 申请访问餐桌，进入临界区</span></span><br><span class="line">    state[i] = hungry;</span><br><span class="line">    test[i];</span><br><span class="line">    signal(mutex);</span><br><span class="line">    wait(self[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>((state[(i + <span class="number">4</span>) % <span class="number">5</span>] != eating) &amp;&amp; (state[i] == hungry) &amp;&amp; (state[(i + <span class="number">1</span>) % <span class="number">5</span>] != eating)) &#123;</span><br><span class="line">        state[i] = eating;</span><br><span class="line">        signal(self[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">putdown</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    wait(mutex);</span><br><span class="line">    state[i] = thinking;</span><br><span class="line">    test[(i + <span class="number">1</span>) % <span class="number">5</span>];</span><br><span class="line">    test[(i + <span class="number">4</span>) % <span class="number">5</span>];</span><br><span class="line">    signal(mutex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另一种解法：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">semaphore chopisticks[<span class="number">5</span>] = &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>&#125;;	<span class="comment">// 初始化信号量</span></span><br><span class="line">semaphore mutex = <span class="number">1</span>;</span><br><span class="line">P(<span class="keyword">int</span> i) &#123;	<span class="comment">// 第i个哲学家的进程</span></span><br><span class="line">    wait(mutex);</span><br><span class="line">    wait(chopisticks[i]);</span><br><span class="line">    wait(chopisticks[(i + <span class="number">1</span>) % <span class="number">5</span>]);</span><br><span class="line">    signal(mutex);</span><br><span class="line">    eat;</span><br><span class="line">    signal(chopisticks[i]);</span><br><span class="line">    signal(chopisticks[(i + <span class="number">1</span>) % <span class="number">5</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="睡眠理发师问题"><a href="#睡眠理发师问题" class="headerlink" title="睡眠理发师问题"></a>睡眠理发师问题</h4><p>理发店有一位理发师，一把理发椅和n把供等待理发的顾客坐的椅子。如果没有顾客，理发师便在理发椅上睡觉，一个顾客到来时，顾客必须叫醒理发师，如果理发师正在理发时又有顾客到来，则如果有空椅子可坐，就坐下来等待，否则就离开</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> chairs = N;</span><br><span class="line"><span class="keyword">int</span> waitings = <span class="number">0</span>;</span><br><span class="line">semaphore mutex;	<span class="comment">// 对等待理发的人数的互斥修改</span></span><br><span class="line">semaphore customer;</span><br><span class="line">semaphore barber;</span><br><span class="line"><span class="comment">// 顾客</span></span><br><span class="line">wait(mutex);</span><br><span class="line"><span class="keyword">if</span>(waiting &lt; chairs) &#123;</span><br><span class="line">    waitings++;</span><br><span class="line">    signal(customer);</span><br><span class="line">    signal(mutex);</span><br><span class="line">    wait(barber);</span><br><span class="line">    理发;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    signal(mutex);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 理发师</span></span><br><span class="line">wait(customer);</span><br><span class="line">wait(mutex);</span><br><span class="line">waitings--;</span><br><span class="line">signal(mutex);</span><br><span class="line">signal(barber);	<span class="comment">// 开放临界区</span></span><br><span class="line">理发;</span><br></pre></td></tr></table></figure>

<h3 id="考研题详解"><a href="#考研题详解" class="headerlink" title="考研题详解"></a>考研题详解</h3><h4 id="1-单向行驶问题"><a href="#1-单向行驶问题" class="headerlink" title="1. 单向行驶问题"></a>1. 单向行驶问题</h4><div align="left" style="float: left">
    <img src="E:\Study\学习\大三上学习资料\操作系统\桥.png" width="200">
</div>

<p>有桥如图所示，车辆方向如箭头所示，回答如下问题<br>(1) 假设该桥上每次只能有一辆车行驶，试用信号灯的wait(), signal()操作实现交通管理<br>(2) 假设该桥上不允许辆车交会，但允许同方向多个车一次通过(即桥上可由多个同方向行驶的车)。试用信号灯的wait(), signal()操作实现交通管理</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">semaphore bridge = <span class="number">1</span>; <span class="comment">// 对桥的控制权</span></span><br><span class="line">semaphore north_mutex = <span class="number">1</span>;	<span class="comment">// 北边的控制权</span></span><br><span class="line">semaphore south_mutex = <span class="number">1</span>;	<span class="comment">// 南边的控制权</span></span><br><span class="line"><span class="keyword">int</span> count1 = <span class="number">0</span>;	<span class="comment">// 记录从北边来的车辆的数量</span></span><br><span class="line"><span class="keyword">int</span> count2 = <span class="number">0</span>;	<span class="comment">// 记录从南边来的车辆的数量</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">car_from_north</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    wait(north_mutex);</span><br><span class="line">    count1++;</span><br><span class="line">    <span class="keyword">if</span>(count1 == <span class="number">1</span>) &#123;</span><br><span class="line">        wait(bridge);</span><br><span class="line">    &#125;</span><br><span class="line">    signal(north_mutex);</span><br><span class="line">    <span class="comment">// 过桥</span></span><br><span class="line">    wait(north_mutex);</span><br><span class="line">    count1--;</span><br><span class="line">    <span class="keyword">if</span>(count1 == <span class="number">0</span>) &#123;</span><br><span class="line">        signal(bridge);</span><br><span class="line">    &#125;</span><br><span class="line">    signal(north_mutex);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 南边与北边对称</span></span><br></pre></td></tr></table></figure>

<h4 id="2-士兵过桥问题"><a href="#2-士兵过桥问题" class="headerlink" title="2.士兵过桥问题"></a>2.士兵过桥问题</h4><p>独木桥的左右两端各停留一队士兵，左侧有 m 个，右侧有 n 个。两侧士兵均可上桥，但一旦有一侧士兵上桥，另一侧士兵必须等待已上桥一侧的士兵全部通过后才可上桥。试使用信号量描述此过程。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> left = <span class="number">0</span>, right = <span class="number">0</span>;	<span class="comment">// 记录左右两侧已经通过的士兵数目</span></span><br><span class="line">semaphore left_mutex = right_mutex = <span class="number">1</span>;	<span class="comment">// 控制两队士兵数量的读写互斥</span></span><br><span class="line">semophore bridge = <span class="number">1</span>;	<span class="comment">// 控制桥的资源</span></span><br><span class="line"><span class="comment">// 左侧士兵</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    wait(left_mutex);</span><br><span class="line">    left++;</span><br><span class="line">    <span class="keyword">if</span>(left == <span class="number">1</span>) &#123;</span><br><span class="line">        wait(bridge);</span><br><span class="line">    &#125;</span><br><span class="line">    signal(left_mutex);</span><br><span class="line">    <span class="comment">// 过桥</span></span><br><span class="line">    <span class="keyword">if</span>(left == m) &#123;</span><br><span class="line">        signal(bridge);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">while</span>(<span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<h4 id="3-双向有限行驶问题"><a href="#3-双向有限行驶问题" class="headerlink" title="3. 双向有限行驶问题"></a>3. 双向有限行驶问题</h4><p>在南开大学和天津大学之间有一条小路 S -&gt; T，小路中间有一个安全岛 M，安全岛能够同时容纳两辆自行车，可供两个已经从两端进入小路的自行车错车用。整个地图如下图，S 到 K 段的小路和 T 到 L 段的小路同时都只能允许一辆自行车通过。试设计一个算法，使来往的自行车都能顺利通过。</p>
<p><img src="http://qiniu.forec.cn/nankai-tianda.jpg" alt="img"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">semaphore S = T = <span class="number">1</span>;	<span class="comment">// 两端最多允许进入一辆</span></span><br><span class="line">semaphore SK = LT = <span class="number">1</span>;	<span class="comment">// 两段小路最多允许进入一辆</span></span><br><span class="line"><span class="comment">// 从S口进入的自行车</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    wait(S);</span><br><span class="line">    wait(Sk);</span><br><span class="line">    <span class="comment">// 通过S-K一段小路</span></span><br><span class="line">    signal(SK);</span><br><span class="line">    <span class="comment">// 进入安全岛</span></span><br><span class="line">    wait(LT);</span><br><span class="line">    <span class="comment">// 通过L-T一段小路</span></span><br><span class="line">    signal(LT);</span><br><span class="line">    signal(S);</span><br><span class="line">&#125; <span class="keyword">while</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">// T口进入的自行车与S口进入的自行车对称</span></span><br></pre></td></tr></table></figure>

<h4 id="4-理发店问题"><a href="#4-理发店问题" class="headerlink" title="4. 理发店问题"></a>4. 理发店问题</h4><p>一个理发店配有一个有 10 个椅子的休息室和一个有理发椅的理发室。如果没有顾客则理发师睡觉；如果顾客来了而休息室、理发椅都没有空则离开；如果理发师在忙而有空的椅子，则顾客选择一个坐下等待；如果理发师在睡觉则顾客摇醒他。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> count = <span class="number">11</span>;	<span class="comment">// 空闲的椅子数量</span></span><br><span class="line">semaphore mutex = <span class="number">1</span>;	<span class="comment">// 对椅子数量的修改互斥</span></span><br><span class="line">semaphore barber_chair = <span class="number">1</span>;	<span class="comment">// 理发师的互斥，同时只能给一个人理发</span></span><br><span class="line">semaphore customers = <span class="number">0</span>;	<span class="comment">// 顾客人数</span></span><br><span class="line"><span class="comment">// 顾客</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    wait(mutex);</span><br><span class="line">    <span class="keyword">if</span>(count == <span class="number">0</span>) &#123;</span><br><span class="line">        signal(mutex);</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(count == <span class="number">11</span>) &#123;</span><br><span class="line">        signal(customer);</span><br><span class="line">        <span class="comment">// 唤醒barber</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">while</span>(<span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<h4 id="5-上机实习问题"><a href="#5-上机实习问题" class="headerlink" title="5. 上机实习问题"></a>5. 上机实习问题</h4><p>某高校计算机系安排学生上机实习，机房共 30 台机器，有超过 60 名学生选课。规定每两个学生一组，一组占一台机器，协同完成实习。只有凑够两个学生且机房仍有空闲机器的情况下，门卫才允许该组学生进入机房。每组上机实习结束时需要由一名固定的老师检查完毕后，该组学生才可离开。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;	<span class="comment">// 开始时在机房等候的学生人数</span></span><br><span class="line">semaphore mutex = <span class="number">1</span>;	<span class="comment">// 修改学生人数的互斥信号量</span></span><br><span class="line">semaphore teacher = <span class="number">1</span>;	<span class="comment">// 验收的老师</span></span><br><span class="line">semaphore machine = <span class="number">30</span>;	<span class="comment">// 30台机器</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 学生进程</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    wait(mutex);</span><br><span class="line">    count++;</span><br><span class="line">    <span class="keyword">int</span> id = count;	<span class="comment">// 记录自己的序号</span></span><br><span class="line">    <span class="keyword">if</span>(count % <span class="number">2</span> == <span class="number">0</span>) &#123;	<span class="comment">// 偶数号的学生</span></span><br><span class="line">        wait(machine);</span><br><span class="line">    &#125;</span><br><span class="line">    signal(mutex);</span><br><span class="line">    <span class="comment">// 上机</span></span><br><span class="line">    <span class="comment">// 上机完成，等待验收</span></span><br><span class="line">    wait(teacher);</span><br><span class="line">    <span class="comment">// 验收</span></span><br><span class="line">    <span class="keyword">if</span>(temp % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        signal(machine);	<span class="comment">// 由偶数号的学生释放机器</span></span><br><span class="line">        wait(mutex);</span><br><span class="line">        count -= <span class="number">2</span>;		<span class="comment">// 一组学生离开</span></span><br><span class="line">        signal(mutex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">while</span>(<span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<h4 id="6-吸烟者问题"><a href="#6-吸烟者问题" class="headerlink" title="6. 吸烟者问题"></a>6. 吸烟者问题</h4><p>假设一个系统有 3 个吸烟者进程和一个供应商进程，制造一根香烟需要三种材料各一份。三个吸烟者分别无限量的拥有三种材料中的一种。供应商进程可以无限量的供应这三种材料，一旦一个吸烟者想吸烟，则他向供应商发出请求，供应商会为这个吸烟者提供另外两种材料。供货商同时只能为一个吸烟者提供服务，多个吸烟者同时发出请求时按固定顺序服务。如此循环往复，请用信号量编写程序控制四个进程同步执行。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> smoker1, smoker2, smoker3;	<span class="comment">// 分别表示1、2、3这三个吸烟者</span></span><br><span class="line">semaphore a = b = c = <span class="number">0</span>;	<span class="comment">// 初始供应的三种材料数量，1、2、3分别持有a、b、c类型的材料</span></span><br><span class="line">semaphore smoker_request = <span class="number">1</span>;	<span class="comment">// 吸烟者发出请求的权限</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 供应商</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(smoker1 == <span class="literal">true</span>) &#123;</span><br><span class="line">        signal(b);</span><br><span class="line">        signal(c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(smoker2 == <span class="literal">true</span>) &#123;</span><br><span class="line">        signal(a);</span><br><span class="line">        signal(c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(smoker3 == <span class="literal">true</span>) &#123;</span><br><span class="line">        signal(b);</span><br><span class="line">        signal(c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">while</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 吸烟者1</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    wait(smoker_request);</span><br><span class="line">    smoker1 = <span class="literal">true</span>;</span><br><span class="line">    wait(b);</span><br><span class="line">    wait(c);</span><br><span class="line">    signal(smoker_request);</span><br><span class="line">&#125; <span class="keyword">while</span>(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h4 id="7-苹果-句子或老虎与猪"><a href="#7-苹果-句子或老虎与猪" class="headerlink" title="7. 苹果-句子或老虎与猪"></a>7. 苹果-句子或老虎与猪</h4><p>有一个笼子可以容纳一只老虎或者两只猪，如果笼子中已经有猪，则老虎不能被放入。猎人 A 每次向笼子中放入一只老虎，猎人 B 每次向笼子中放入一只猪。饲养员每次会从笼子中取出一只老虎，厨师每次会从笼子中取出一只猪。对笼子的操作是互斥的。试用信号量描述此过程。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">semaphore pig = <span class="number">0</span>, tiger = <span class="number">0</span>;	<span class="comment">//  对猪和老虎的互斥访问</span></span><br><span class="line">semaphore coop = <span class="number">1</span>;	<span class="comment">// 对笼子的互斥读写</span></span><br><span class="line">semaphore pig_space = <span class="number">2</span>;	<span class="comment">// 用于限制可以放置猪的剩余空间</span></span><br><span class="line">semaphore pig_count_mutex = <span class="number">1</span>;	<span class="comment">// 用于限制对pig_count的互斥读写</span></span><br><span class="line"><span class="keyword">int</span> pig_count = <span class="number">0</span>;	<span class="comment">// 记录当前在笼子中的猪的数量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 猎人A</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">// 抓到一只老虎</span></span><br><span class="line">    wait(coop);</span><br><span class="line">    <span class="comment">// 将老虎放入笼子</span></span><br><span class="line">    signal(tiger);</span><br><span class="line">&#125; <span class="keyword">while</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">// 饲养员</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    wait(tiger);</span><br><span class="line">    <span class="comment">// 从笼子中取出老虎</span></span><br><span class="line">    signal(coop);</span><br><span class="line">&#125; <span class="keyword">while</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">// 猎人B</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">// 抓到一只猪</span></span><br><span class="line"> 	wait(pig_space);</span><br><span class="line">    wait(pig_count_mutex);</span><br><span class="line">    pig_count++;</span><br><span class="line">    <span class="keyword">if</span>(pig_count == <span class="number">1</span>) &#123;</span><br><span class="line">        wait(coop);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 将猪放进笼子</span></span><br><span class="line">    signal(pig);</span><br><span class="line">    signal(pig_count_mutex);</span><br><span class="line">&#125; <span class="keyword">while</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">// 厨师</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    wait(pig);</span><br><span class="line">    wait(pig_count_mutex);</span><br><span class="line">    <span class="comment">// 从笼子中取出一只猪</span></span><br><span class="line">    pig_count--;</span><br><span class="line">    <span class="keyword">if</span>(pig_count == <span class="number">0</span>) &#123;</span><br><span class="line">        signal(coop);</span><br><span class="line">    &#125;</span><br><span class="line">    signal(pig_count_mutex);</span><br><span class="line">    signal(pig_space);</span><br><span class="line">&#125; <span class="keyword">while</span>(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h4 id="8"><a href="#8" class="headerlink" title="8."></a>8.</h4><p>三个进程P1、P2、P3互斥使用一个包含N（N&gt;0）个单元的缓冲区。P1每次用produce()生成一个正整数并用put()送入缓冲区某一空单元。P2每次用getodd()从该缓冲区中取出一个奇数并用countodd()统计奇数个数。P3每次用geteven()从该缓冲区中取出一个偶数并用counteven()统计偶数个数。请用信号量机制实现这三个进程的同步与互斥活动，并说明定义的信号量的含义</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">semaphore mutex;	<span class="comment">// 用于对缓冲区的互斥读写</span></span><br><span class="line">semaphore odd, even;	<span class="comment">// 计数和偶数的计数信号量</span></span><br><span class="line">semaphore empty = N;	<span class="comment">// 空余的缓冲区的数量</span></span><br><span class="line"><span class="comment">// P1进程</span></span><br><span class="line">wait(empty);</span><br><span class="line">x = produce();</span><br><span class="line">wait(mutex);</span><br><span class="line">put();</span><br><span class="line">signal(mutex);</span><br><span class="line"><span class="keyword">if</span>(x % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">    signal(odd);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    signal(even);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// P2进程</span></span><br><span class="line">wait(odd);</span><br><span class="line">wait(mutex);</span><br><span class="line">getodd();</span><br><span class="line">signal(mutex);</span><br><span class="line">signal(empty);</span><br><span class="line">countodd();</span><br><span class="line"><span class="comment">// P3进程与P2同理</span></span><br></pre></td></tr></table></figure>

<h4 id="9"><a href="#9" class="headerlink" title="9."></a>9.</h4><p>在一个仓库可以存放A和B两种产品，要求：</p>
<ul>
<li>每次只能存入一种产品</li>
<li>A产品数量 - B产品数量 &lt; M</li>
<li>B产品数量 - A产品数量  &lt; N</li>
</ul>
<p>描述产品A与产品B的入库过程</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">semaphore mutex;	<span class="comment">// 商品入库过程的互斥</span></span><br><span class="line">semaphore Sa = M - <span class="number">1</span>, Sb = N - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> countA = <span class="number">0</span>, countB = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A产品进仓库过程</span></span><br><span class="line">wait(Sa);</span><br><span class="line">wait(mutex);</span><br><span class="line">A产品入库;</span><br><span class="line">signal(mutex);</span><br><span class="line">signal(Sb);</span><br><span class="line"><span class="comment">// B产品入库</span></span><br><span class="line">wait(Sb);</span><br><span class="line">wait(mutex);</span><br><span class="line">B产品入库;</span><br><span class="line">signal(mutex);</span><br><span class="line">signal(Sa);</span><br></pre></td></tr></table></figure>

<h4 id="10"><a href="#10" class="headerlink" title="10."></a>10.</h4><p>面包师有很多面包，由n个销售人员推销，每个顾客进店后取一个号，并且等待叫号，当一个销售人员空闲下来时，就叫下一个号，试设计一个使销售人员和顾客同步的算法</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;	<span class="comment">// i表示取号值，j表示叫号值</span></span><br><span class="line">semaphore mutex_i, mutex_j;</span><br><span class="line"><span class="comment">// 顾客进程</span></span><br><span class="line">wait(mutex_i);</span><br><span class="line">取号;</span><br><span class="line">i++;</span><br><span class="line">signal(mutex_i);</span><br><span class="line">等待叫号i并购买面包;</span><br><span class="line"><span class="comment">// 销售员进程</span></span><br><span class="line">wait(mutex_j);</span><br><span class="line"><span class="keyword">if</span>(j &lt; i) &#123;</span><br><span class="line">    叫号;</span><br><span class="line">    j++;</span><br><span class="line">    signal(mutex_j);</span><br><span class="line">    销售面包;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    signal(mutex_j);</span><br><span class="line">    休息片刻;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="11"><a href="#11" class="headerlink" title="11."></a>11.</h4><p>设自行车生产线上有一只箱子，其中有N个位置（N&gt;=3），每个位置可存放一个车架或一个车轮；又设有3个工人，其活动分别为：</p>
<ul>
<li>工人1：加工一个车架，车架放入箱中</li>
<li>工人2：加工一个车轮，车轮放入箱中</li>
<li>工人3：箱中取一个车架，取一个车轮，组装为一台车</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">semaphore empty = N;</span><br><span class="line">semaphore wheel = <span class="number">0</span>;	<span class="comment">// 车轮</span></span><br><span class="line">semaphore frame = <span class="number">0</span>;	<span class="comment">// 车架</span></span><br><span class="line">semaphore s1 = N - <span class="number">1</span>;	<span class="comment">// 车架最大数</span></span><br><span class="line">semaphore s2 = N - <span class="number">2</span>;	<span class="comment">// 车轮最大数</span></span><br><span class="line"><span class="comment">// 工人1活动</span></span><br><span class="line">加工一个车架;</span><br><span class="line">wait(s1);	<span class="comment">// 检查车架数是否已经达到最大值</span></span><br><span class="line">wait(empty);</span><br><span class="line">车架放入箱中;</span><br><span class="line">signal(frame);</span><br><span class="line"><span class="comment">// 工人2活动</span></span><br><span class="line">加工一个车轮;</span><br><span class="line">wait(s2);</span><br><span class="line">wait(empty);</span><br><span class="line">车轮放入箱中;</span><br><span class="line">signal(wheel);</span><br><span class="line"><span class="comment">// 工人3活动</span></span><br><span class="line">wait(frame);</span><br><span class="line">箱中取一个车轮;</span><br><span class="line">signal(empty);</span><br><span class="line">signal(s1);</span><br><span class="line">wait(wheel);</span><br><span class="line">wait(wheel);</span><br><span class="line">箱中取两个车轮;</span><br><span class="line">signal(empty);</span><br><span class="line">signal(empty);</span><br><span class="line">signal(s2);</span><br><span class="line">signal(s2);</span><br><span class="line">组装为一台车;</span><br></pre></td></tr></table></figure>

<h4 id="12"><a href="#12" class="headerlink" title="12."></a>12.</h4><p>系统中有多个生产者进程和多个消费者进程，共享一个能存放1000件产品的环形缓冲区（初始为空），当缓冲区未满时，生产者进程可以放入其生产的一个产品，否则等待；当缓冲区未空时，消费者进程可以从缓冲区取走一件产品，否则等待。要求一个消费者进程从缓冲区连续取出10间产品后，其他消费者才可以取产品。</p>
<p><code>这道题的解答感觉有问题，当产品的剩余数量不足10个的时候，消费者还控制着mutex1，但是有没有产品，生产者因为得不到mutex1，也不能生产，因此会造成死锁的问题</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">semophere mutex1 = <span class="number">1</span>, mutex2 = <span class="number">1</span>;</span><br><span class="line">semophere empty = n, full = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// 生产者</span></span><br><span class="line">wait(empty);</span><br><span class="line">wait(mutex1);</span><br><span class="line">放入一件产品;</span><br><span class="line">signal(mutex1);</span><br><span class="line">signal(full);</span><br><span class="line"><span class="comment">// 消费者</span></span><br><span class="line">wait(mutex1);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">10</span>;i++) &#123;</span><br><span class="line">    wait(full);</span><br><span class="line">    wait(mutex2);</span><br><span class="line">    把产品放入缓冲区;</span><br><span class="line">    signal(mutex2);</span><br><span class="line">    signal(empty);</span><br><span class="line">    消费这件产品;</span><br><span class="line">&#125;</span><br><span class="line">signal(mutex1);</span><br></pre></td></tr></table></figure>

<h4 id="13-生产者-消费者问题扩展"><a href="#13-生产者-消费者问题扩展" class="headerlink" title="13. 生产者-消费者问题扩展"></a>13. 生产者-消费者问题扩展</h4><p>桌子上有一只盘子，每次只能向其中放入一个水果，爸爸专向盘子中放苹果，妈妈专向盘子中放橘子， 儿子专吃盘子中的橘子，女儿专吃盘子中的苹果，只有盘子为空时，爸爸或妈妈就可以向盘子中放一个水果，仅当盘子中有自己需要的水果时，儿子或女儿可以从盘子中取出。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">semaphore plate = <span class="number">1</span>;</span><br><span class="line">semaphore apple = <span class="number">0</span>, orange = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// 爸爸</span></span><br><span class="line">wait(plate);</span><br><span class="line">put the apple;</span><br><span class="line">signal(apple);</span><br><span class="line"><span class="comment">// 妈妈</span></span><br><span class="line">wait(plate);</span><br><span class="line">put the orange;</span><br><span class="line">signal(orange);</span><br><span class="line"><span class="comment">// 女儿</span></span><br><span class="line">wait(apple);</span><br><span class="line">take an apple from the plate;</span><br><span class="line">signal(plate);</span><br><span class="line"><span class="comment">// 儿子</span></span><br><span class="line">wait(orange);</span><br><span class="line">take an orange from the plate;</span><br><span class="line">signal(plate);</span><br></pre></td></tr></table></figure>

<p>9.</p>
<p><img src="C:%5CUsers%5C12751%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1572779448179.png" alt="1572779448179"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">semaphore emptyA = <span class="number">10</span>, fullA = <span class="number">0</span>;</span><br><span class="line">semaphore emptyB = <span class="number">10</span>, fullB = <span class="number">0</span>;</span><br><span class="line">semaphore mutexA, mutexB;</span><br><span class="line"><span class="comment">// 生产A车间</span></span><br><span class="line">wait(emptyA);</span><br><span class="line">wait(mutexA);</span><br><span class="line">把A放入生产车间;</span><br><span class="line">signal(mutexA);</span><br><span class="line">signal(fullA);</span><br><span class="line"><span class="comment">// 生产B车间</span></span><br><span class="line">wait(emptyB);</span><br><span class="line">wait(mutexB);</span><br><span class="line">把B放入生产车间;</span><br><span class="line">signal(mutexB);</span><br><span class="line">signal(fullB);</span><br><span class="line"><span class="comment">// 装配车间</span></span><br><span class="line">wait(fullA);</span><br><span class="line">wait(mutexA);</span><br><span class="line">从车间取一个A;</span><br><span class="line">signal(mutexA);</span><br><span class="line">signal(emptyA);</span><br><span class="line"></span><br><span class="line">wait(fullB);</span><br><span class="line">wait(mutexB);</span><br><span class="line">从车间取一个B;</span><br><span class="line">signal(mutexB);</span><br><span class="line">signal(emptyB);</span><br></pre></td></tr></table></figure>

<p>10.</p>
<p><img src="C:%5CUsers%5C12751%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1572779434654.png" alt="1572779434654"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">semaphore mutex1, mutex2;	<span class="comment">// 分别表示互斥从井中取水和从水缸取水</span></span><br><span class="line">semaphore count = <span class="number">3</span>;	<span class="comment">// 表示水桶</span></span><br><span class="line">semaphore empty = <span class="number">10</span>, full = <span class="number">0</span>;	<span class="comment">// 表示水缸中的剩余容量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 小和尚</span></span><br><span class="line">wait(empty);</span><br><span class="line">wait(count);</span><br><span class="line">wait(mutex1);</span><br><span class="line">取水;</span><br><span class="line">signal(mutex1);</span><br><span class="line"></span><br><span class="line">wait(mutex2);</span><br><span class="line">往水井倒水;</span><br><span class="line">signal(mutex2);</span><br><span class="line">signal(count);	<span class="comment">// 放弃桶</span></span><br><span class="line">signal(full);</span><br><span class="line"><span class="comment">// 老和尚</span></span><br><span class="line">wait(full);</span><br><span class="line">wait(count);</span><br><span class="line">wait(mutex2);</span><br><span class="line">取水;</span><br><span class="line">signal(mutex2);</span><br><span class="line">signal(empty);</span><br><span class="line">signal(count);</span><br></pre></td></tr></table></figure>

<p>12.</p>
<p><img src="C:%5CUsers%5C12751%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1572779424549.png" alt="1572779424549"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">semaphore mutex;	<span class="comment">// 取号的互斥访问</span></span><br><span class="line">semaphore empty = <span class="number">10</span>, full = <span class="number">0</span>;</span><br><span class="line">semaphore keeper = <span class="number">1</span>;</span><br><span class="line"><span class="comment">// 顾客</span></span><br><span class="line">wait(empty);</span><br><span class="line">wait(mutex);</span><br><span class="line">取号;</span><br><span class="line">signal(mutex);</span><br><span class="line">signal(full);</span><br><span class="line">等待叫号;</span><br><span class="line">wait(keeper);</span><br><span class="line">获取服务;</span><br><span class="line"><span class="comment">// 营业员</span></span><br><span class="line">wait(full);</span><br><span class="line">叫号;</span><br><span class="line">signal(empty);</span><br><span class="line">为客户服务;</span><br><span class="line">signal(keeper);</span><br></pre></td></tr></table></figure>

<p>13.</p>
<p><img src="C:%5CUsers%5C12751%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1572779408974.png" alt="1572779408974"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">semaphore bridge;</span><br><span class="line">semaphore mutexN, mutexS;</span><br><span class="line"><span class="keyword">int</span> northcount = <span class="number">0</span>, southcount = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// 从北到南</span></span><br><span class="line">wait(mutexN);</span><br><span class="line">northcount++;</span><br><span class="line"><span class="keyword">if</span>(northcount == <span class="number">1</span>) &#123;</span><br><span class="line">    wait(bridge);</span><br><span class="line">&#125;</span><br><span class="line">signal(mutexN);</span><br><span class="line">过桥;</span><br><span class="line">wait(mutexN);</span><br><span class="line">northcount--;</span><br><span class="line"><span class="keyword">if</span>(northcount == <span class="number">0</span>) &#123;</span><br><span class="line">    signal(bridge);</span><br><span class="line">&#125;</span><br><span class="line">signal(mutexN); = <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>18.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">semaphore movie1 = <span class="number">0</span>, movie2 = <span class="number">0</span>, movie3 = <span class="number">0</span>;</span><br><span class="line">semaphore mutex1, mutex2, mutex3;</span><br><span class="line"><span class="keyword">int</span> count1 = <span class="number">0</span>, count2 = <span class="number">0</span>, count3 = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// 选择观看电影1的观众</span></span><br><span class="line">wait(movie1);</span><br><span class="line">wait(mutex1);</span><br><span class="line">count1++;</span><br><span class="line">signal(mutex1);</span><br><span class="line">观看电影;</span><br><span class="line">wait(mutex1);</span><br><span class="line">count1--;</span><br><span class="line"><span class="keyword">if</span>(count1 == <span class="number">0</span>) &#123;</span><br><span class="line">    signal(movie1);</span><br><span class="line">&#125;</span><br><span class="line">signal(mutex1);</span><br><span class="line"><span class="comment">// 选择观看电影2的观众</span></span><br><span class="line">wait(movie2);</span><br><span class="line">... 同理;</span><br><span class="line">最后signal(movie3);</span><br></pre></td></tr></table></figure>

<p>21.</p>
<p><img src="C:%5CUsers%5C12751%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1572779372327.png" alt="1572779372327"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 驾驶员</span></span><br><span class="line">wait(mutex1);</span><br><span class="line">...</span><br><span class="line">signal(mutex2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 售票员</span></span><br><span class="line">wait(mutex2);</span><br><span class="line">开车门;</span><br><span class="line">...</span><br><span class="line">关车门;</span><br><span class="line">signal(mutex1);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>22.</p>
<p><img src="C:%5CUsers%5C12751%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1572779358412.png" alt="1572779358412"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">semophere emptyA, fullA, emptyB, fullB;</span><br><span class="line">semophere mutexA, mutexB;</span><br><span class="line">wait(fullA);</span><br><span class="line">wait(mutexA);</span><br><span class="line">取邮件;</span><br><span class="line">signal(mutexA);</span><br><span class="line">signla(emptyA);</span><br><span class="line">回答&amp;提出问题;</span><br><span class="line">wait(emptyB);</span><br><span class="line">wait(mutexB);</span><br><span class="line">放入B的邮箱中;</span><br><span class="line">signal(mutexB);</span><br><span class="line">signal(fullB);</span><br></pre></td></tr></table></figure>

<p>23.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://woojoo520.github.io/2019/10/20/Transfer-Learning/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mariana">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Celery Fairy">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/20/Transfer-Learning/" itemprop="url">Transfer Learning</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-20T00:06:59+08:00">
                2019-10-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Transfer-Learning"><a href="#Transfer-Learning" class="headerlink" title="Transfer Learning"></a>Transfer Learning</h2><h3 id="初步了解Transfer-Learning"><a href="#初步了解Transfer-Learning" class="headerlink" title="初步了解Transfer Learning"></a>初步了解Transfer Learning</h3><p>Matthew D. Zeiler和Rob Fergus发表了一片著名的论文， 阐述卷积神经网络到底“看”到了什么：<a href="https://www.zhihu.com/topic/20079475/intro#ref_2" target="_blank" rel="noopener">[2]</a></p>
<p><img src="https://pic1.zhimg.com/v2-8aaa5f69e139f987bb53538bd212da58_b.jpg" alt="img"></p>
<p>和对卷积层进行简单的成像不同，他们尝试把不同的内容输入到训练好的神经网络，并观察记录卷积核的激活值。并把造成相同卷积核较大激活的内容分组比较。上面的图片中每个九宫格为同一个卷积核对不同图片的聚类。</p>
<p>在上面图片中可以看出，较浅层的卷积层将较为几何抽象的内容归纳到了一起。例如第一层的卷积中，基本就是边缘检测。而第二层的卷积中，聚类了相似的几何形状，尽管这些几何形状的内容相差甚远。</p>
<p>随着卷积层越来越深，所聚类的内容也越来越具体。</p>
<p>其实有个最简单易行的方式已经摆在我们面前了：如果我们把卷积神经网络的前n层保留下来，剩下不想要的砍掉怎么样？就像是我们可以不需要ct能识别狗，识别猫，但是轮廓的对我们还是很有帮助的</p>
<p><img src="https://pic4.zhimg.com/v2-486d24854876bb536978e32e801eee23_b.jpg" alt="img"></p>
<h3 id="迁移学习的三个主要研究问题"><a href="#迁移学习的三个主要研究问题" class="headerlink" title="迁移学习的三个主要研究问题"></a>迁移学习的三个主要研究问题</h3><ul>
<li>迁移什么</li>
<li>如何迁移</li>
<li>何时迁移</li>
</ul>
<h5 id="迁移什么"><a href="#迁移什么" class="headerlink" title="迁移什么"></a>迁移什么</h5><p>指的是跨域或跨任务迁移哪一部分知识。目前，迁移学习的内容可以分为四类：实例迁移、特征表示迁移、参数迁移、关系知识迁移</p>
<h5 id="如何迁移"><a href="#如何迁移" class="headerlink" title="如何迁移"></a>如何迁移</h5><p>开发学习算法</p>
<h5 id="何时迁移"><a href="#何时迁移" class="headerlink" title="何时迁移"></a>何时迁移</h5><p>指得是在什么情况下可以迁移，在哪些情况下不应该迁移。在某些情况下，当源域和目标域彼此不相关时，强行迁移可能会失败。而在最坏的情况下它甚至可能损害目标域的学习表现，这种情况下通常被称为负迁移。</p>
<h3 id="迁移学习方法划分"><a href="#迁移学习方法划分" class="headerlink" title="迁移学习方法划分"></a>迁移学习方法划分</h3><p>根据源域和目标域与任务之间的不同情况，将迁移学习分为三个类别：</p>
<ul>
<li><p><strong>归纳式迁移学习（Inductive Transfer Learning）</strong></p>
<p>在归纳式迁移学习中，无论源域和目标域是否相同，目标任务都与源任务不同。算法利用来自源域的归纳假设和归纳偏差帮助改进目标任务。根据源域中数据的不同情况，归纳式迁移学习进一步分为两种情况：</p>
<ul>
<li>源域中有很多带标签的数据。在这种情况下，归纳迁移学习设置类似于多任务学习设置。但是，归纳式迁移学习设置仅旨在通过迁移源任务中的只是来实现目标任务中的高性能，而多任务学习则尝试同时学习目标任务和源任务</li>
<li>源域中没有标签数据。在这种情况下归纳学习类似于自学习。在自学习设置中，源域和目标域之间的标签空间可能不同，这意味着不能直接使用源域的信息。</li>
</ul>
</li>
<li><p><strong>无监督迁移学习（Unsupervised Transfer Learning）</strong></p>
<p>在无监督迁移学习设置中，与归纳迁移学习设置类似，目标任务不同于源任务，但与源任务有关。然而，无监督学习侧重于解决目标域中的无监督学习任务，例如聚类，降维和密度估计。在这种情况下，源域和目标域中都没有可用的标签数据。</p>
</li>
<li><p><strong>直推式迁移学习（Transductive Transfer Learning）</strong></p>
<p>在直推式迁移学习设置中，源任务和目标任务是相同的，而源域和目标域是不同的。在这种情况下，目标域没有可用的标签数据，而源域中有许多可用的标签数据，另外，根据源域和目标域之间的不同情况，我们可以进一步将直推式学习设置分为两种情况：</p>
<ul>
<li>源域和目标域之间的特征空间不同</li>
<li>源域和目标域之间的特征空间相同，但输入数据的边际概率分布不同</li>
</ul>
</li>
</ul>
<p><img src="https://pic4.zhimg.com/80/v2-fcaf713f373f3f993829249c1041059f_hd.png" alt="img"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://woojoo520.github.io/2019/10/19/SQLServer-Day9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mariana">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Celery Fairy">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/19/SQLServer-Day9/" itemprop="url">SQLServer-Day9</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-19T10:18:58+08:00">
                2019-10-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="SQLServer-Day9"><a href="#SQLServer-Day9" class="headerlink" title="SQLServer-Day9"></a>SQLServer-Day9</h2><h3 id="178-分数排名"><a href="#178-分数排名" class="headerlink" title="178. 分数排名"></a>178. 分数排名</h3><p>编写一个 SQL 查询来实现分数排名。如果两个分数相同，则两个分数排名（Rank）相同。请注意，平分后的下一个名次应该是下一个连续的整数值。换句话说，名次之间不应该有“间隔”。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+----+-------+</span><br><span class="line">| Id | Score |</span><br><span class="line">+----+-------+</span><br><span class="line">| 1  | 3.50  |</span><br><span class="line">| 2  | 3.65  |</span><br><span class="line">| 3  | 4.00  |</span><br><span class="line">| 4  | 3.85  |</span><br><span class="line">| 5  | 4.00  |</span><br><span class="line">| 6  | 3.65  |</span><br><span class="line">+----+-------+</span><br></pre></td></tr></table></figure>

<p>例如，根据上述给定的 Scores 表，你的查询应该返回（按分数从高到低排列）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+-------+------+</span><br><span class="line">| Score | Rank |</span><br><span class="line">+-------+------+</span><br><span class="line">| 4.00  | 1    |</span><br><span class="line">| 4.00  | 1    |</span><br><span class="line">| 3.85  | 2    |</span><br><span class="line">| 3.65  | 3    |</span><br><span class="line">| 3.65  | 3    |</span><br><span class="line">| 3.50  | 4    |</span><br><span class="line">+-------+------+</span><br></pre></td></tr></table></figure>

<p>Code：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Score, <span class="keyword">dense_rank</span>() <span class="keyword">over</span> (<span class="keyword">ORDER</span> <span class="keyword">BY</span> Score <span class="keyword">DESC</span>) <span class="keyword">as</span> <span class="keyword">Rank</span></span><br><span class="line"><span class="keyword">FROM</span> Scores</span><br></pre></td></tr></table></figure>

<p><strong>Tips：</strong>SQL Server中<code>ROW_NUMBER()</code> 和 <code>RANK()</code> 和 <code>DENSE_RANK()</code>这三个函数都是对分过组的数据排序，凡是又各有区别：</p>
<blockquote>
<p>ROWNUMBER() OVER ([PARTITION BY Columns1 ORDER BY columns2)</p>
</blockquote>
<blockquote>
<p>DENSE_RANK() OVER ([PARTITION BY Columns1] ORDER BY columns2)</p>
</blockquote>
<blockquote>
<p>RANK() OVER ([PARTITION BY Columns1] ORDER BY columns2)</p>
</blockquote>
<p>这三个函数都是按照column1分组从1开始排序</p>
<p>其中，<code>ROW_NUMBER()</code>是没有重复值的排序（即使两条记录仙童，序号也不重复），不会有同名次</p>
<p><code>DENSE_RANK()</code>是连续的排序，两个第二名仍然跟着第三名</p>
<p><code>RANK()</code>是跳跃排序，两个第二名下来就是第四名</p>
<h3 id="184-部门工资最高的员工"><a href="#184-部门工资最高的员工" class="headerlink" title="184. 部门工资最高的员工"></a>184. 部门工资最高的员工</h3><p>Employee 表包含所有员工信息，每个员工有其对应的 Id, salary 和 department Id。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+----+-------+--------+--------------+</span><br><span class="line">| Id | Name  | Salary | DepartmentId |</span><br><span class="line">+----+-------+--------+--------------+</span><br><span class="line">| 1  | Joe   | 70000  | 1            |</span><br><span class="line">| 2  | Henry | 80000  | 2            |</span><br><span class="line">| 3  | Sam   | 60000  | 2            |</span><br><span class="line">| 4  | Max   | 90000  | 1            |</span><br><span class="line">+----+-------+--------+--------------+</span><br></pre></td></tr></table></figure>

<p>Department 表包含公司所有部门的信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+----+----------+</span><br><span class="line">| Id | Name     |</span><br><span class="line">+----+----------+</span><br><span class="line">| 1  | IT       |</span><br><span class="line">| 2  | Sales    |</span><br><span class="line">+----+----------+</span><br></pre></td></tr></table></figure>

<p>编写一个 SQL 查询，找出每个部门工资最高的员工。例如，根据上述给定的表格，Max 在 IT 部门有最高工资，Henry 在 Sales 部门有最高工资。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+------------+----------+--------+</span><br><span class="line">| Department | Employee | Salary |</span><br><span class="line">+------------+----------+--------+</span><br><span class="line">| IT         | Max      | 90000  |</span><br><span class="line">| Sales      | Henry    | 80000  |</span><br><span class="line">+------------+----------+--------+</span><br></pre></td></tr></table></figure>

<p>Code：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> d.Name <span class="keyword">as</span> Department,e.Name <span class="keyword">as</span> Employee, e.Salary <span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> <span class="keyword">max</span>(Salary) <span class="keyword">as</span> Salary,DepartmentId <span class="keyword">from</span> Employee </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> DepartmentId) t </span><br><span class="line"><span class="keyword">join</span> Employee e <span class="keyword">on</span> e.Salary = t.Salary <span class="keyword">and</span> e.DepartmentId = t.DepartmentId</span><br><span class="line"><span class="keyword">join</span> Department d <span class="keyword">on</span> d.Id = e.DepartmentId</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://woojoo520.github.io/2019/10/18/SQLServer-Day8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mariana">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Celery Fairy">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/18/SQLServer-Day8/" itemprop="url">SQLServer-Day8</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-18T19:33:37+08:00">
                2019-10-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="SQLServer-Day8"><a href="#SQLServer-Day8" class="headerlink" title="SQLServer-Day8"></a>SQLServer-Day8</h2><h3 id="AVG-函数"><a href="#AVG-函数" class="headerlink" title="AVG 函数"></a>AVG 函数</h3><p><code>AVG</code>函数但会数值列的平均值，<code>NULL</code></p>
<p>值不包括在计算中</p>
<blockquote>
<p>SELECT AVG(column_name) FROM yable_name</p>
</blockquote>
<p>Orders表：</p>
<table>
<thead>
<tr>
<th align="left">O_Id</th>
<th align="left">OrderDate</th>
<th align="left">OrderPrice</th>
<th align="left">Customer</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">2008/12/29</td>
<td align="left">1000</td>
<td align="left">Bush</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">2008/11/23</td>
<td align="left">1600</td>
<td align="left">Carter</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">2008/10/05</td>
<td align="left">700</td>
<td align="left">Bush</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">2008/09/28</td>
<td align="left">300</td>
<td align="left">Bush</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">2008/08/06</td>
<td align="left">2000</td>
<td align="left">Adams</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">2008/07/21</td>
<td align="left">100</td>
<td align="left">Carter</td>
</tr>
</tbody></table>
<p>例1：计算OrderPrice字段的平均值：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(OrderPrice) <span class="keyword">AS</span> OrderAverage <span class="keyword">FROM</span> Orders</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th align="left">OrderAverage</th>
</tr>
</thead>
<tbody><tr>
<td align="left">950</td>
</tr>
</tbody></table>
<p>例2：找到OrderPrice值高于OrderPrice平均值的客户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Curstomer <span class="keyword">FROM</span> Orders </span><br><span class="line"><span class="keyword">WHERE</span> OrderPrice &gt; (<span class="keyword">SELECT</span> <span class="keyword">AVG</span>(OrderPrice) <span class="keyword">FROM</span> Orders)</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th align="left">Customer</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Bush</td>
</tr>
<tr>
<td align="left">Carter</td>
</tr>
<tr>
<td align="left">Adams</td>
</tr>
</tbody></table>
<h3 id="COUNT函数"><a href="#COUNT函数" class="headerlink" title="COUNT函数"></a>COUNT函数</h3><p><code>COUNT()</code>函数返回匹配指定条件的行数</p>
<h4 id="SQL-COUNT-column-name-语法"><a href="#SQL-COUNT-column-name-语法" class="headerlink" title="SQL COUNT(column_name)语法"></a>SQL COUNT(column_name)语法</h4><p>COUNT(column_name)函数返回指定列的值的数目（NULL不计入）：</p>
<blockquote>
<p>SELECT COUNT(column_name) FROM table_name</p>
</blockquote>
<h4 id="SQL-COUNT-语法"><a href="#SQL-COUNT-语法" class="headerlink" title="SQL COUNT(*)语法"></a>SQL COUNT(*)语法</h4><p>COUNT(*) 函数返回表中的记录数</p>
<blockquote>
<p>SELECT COUNT(*) FROM table_name</p>
</blockquote>
<h4 id="SQL-COUNT-DISTINCT-column-name-语法"><a href="#SQL-COUNT-DISTINCT-column-name-语法" class="headerlink" title="SQL COUNT(DISTINCT column_name)语法"></a>SQL COUNT(DISTINCT column_name)语法</h4><p>COUNT(DISTINCT column_name) 函数返回指定列的不同值的数目：</p>
<blockquote>
<p>SELECT COUNT(DISTINCT column_name) FROM table_name</p>
</blockquote>
<p>注释：<code>COUNT(DISTINCT)</code> 适用于ORACLE和Microsoft SQL Server,但是不能用于Microsoft Access</p>
<p>Orders表：</p>
<table>
<thead>
<tr>
<th align="left">O_Id</th>
<th align="left">OrderDate</th>
<th align="left">OrderPrice</th>
<th align="left">Customer</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">2008/12/29</td>
<td align="left">1000</td>
<td align="left">Bush</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">2008/11/23</td>
<td align="left">1600</td>
<td align="left">Carter</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">2008/10/05</td>
<td align="left">700</td>
<td align="left">Bush</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">2008/09/28</td>
<td align="left">300</td>
<td align="left">Bush</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">2008/08/06</td>
<td align="left">2000</td>
<td align="left">Adams</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">2008/07/21</td>
<td align="left">100</td>
<td align="left">Carter</td>
</tr>
</tbody></table>
<p>例1：计算客户“Carter”的订单数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(Customer) <span class="keyword">AS</span> CustimerNilsen <span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">WHERE</span> Customer = <span class="string">'Carter'</span></span><br></pre></td></tr></table></figure>

<p>以上SQL语句的返回结果是2，因为客户Carter共有2个订单。</p>
<table>
<thead>
<tr>
<th align="left">CustomerNilsen</th>
</tr>
</thead>
<tbody><tr>
<td align="left">2</td>
</tr>
</tbody></table>
<p>例2：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> NumberOfOrders <span class="keyword">FROM</span> Orders</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th align="left">NumberOfOrders</th>
</tr>
</thead>
<tbody><tr>
<td align="left">6</td>
</tr>
</tbody></table>
<p>这是表中的总行数。</p>
<p>例3：计算”Orders”表中不同客户的数目</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> Customer) <span class="keyword">AS</span> NumberOdCustomers <span class="keyword">FROM</span> Orders</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th align="left">NumberOfCustomers</th>
</tr>
</thead>
<tbody><tr>
<td align="left">3</td>
</tr>
</tbody></table>
<h3 id="FIRST-函数"><a href="#FIRST-函数" class="headerlink" title="FIRST()函数"></a>FIRST()函数</h3><p>FIRST()函数返回指定的字段中第一个记录的值。</p>
<p><strong>Tips：</strong>可使用ORDER BY 语句对记录进行排序</p>
<blockquote>
<p>SELECT FIRST(column_name) FROM table_name </p>
</blockquote>
<p>实例：Orders表同上，查找“OrderPrice”列的第一个值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">FIRST</span>(OrderPrice) <span class="keyword">AS</span> FirstOrderPrice <span class="keyword">FROM</span> Orders</span><br></pre></td></tr></table></figure>

<p>结果类似这样：</p>
<table>
<thead>
<tr>
<th align="left">FirstOrderPrice</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1000</td>
</tr>
</tbody></table>
<h3 id="LAST-函数"><a href="#LAST-函数" class="headerlink" title="LAST()函数"></a>LAST()函数</h3><p>LAST()函数返回指定的字段中最后一个记录的值</p>
<p><strong>Tips：</strong>可使用<code>ORDER BY</code> 语句对记录进行排序</p>
<blockquote>
<p>SELECT LAST(column_name) FROM table_name</p>
</blockquote>
<p>例：查找”OrderPrice“列的最后一个值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LAST</span>(OrderPrices) <span class="keyword">AS</span> LastOrderPrice <span class="keyword">FROM</span> Orders</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th align="left">LastOrderPrice</th>
</tr>
</thead>
<tbody><tr>
<td align="left">100</td>
</tr>
</tbody></table>
<h3 id="MAX-和-MIN-函数"><a href="#MAX-和-MIN-函数" class="headerlink" title="MAX() 和 MIN() 函数"></a>MAX() 和 MIN() 函数</h3><p><code>MAX</code>函数返回一列中的最大值，<code>MIN</code>函数返回一列中的最小值。<code>NULL</code>值不包括在计算中</p>
<blockquote>
<p>SELECT MAX(column_name) FROM table_name</p>
</blockquote>
<p>注释：<code>MIN</code>和<code>MAX</code>也可用于文本列，以获得按字母顺序排序的最高或者最低值</p>
<p>Orders表：</p>
<p>例：我们要查找”OrderPrice“列中的最大值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(OrderPrice) <span class="keyword">AS</span> LargestOrderPrice <span class="keyword">FROM</span> Orders</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th align="left">LargestOrderPrice</th>
</tr>
</thead>
<tbody><tr>
<td align="left">2000</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MIN</span>(OrderPrice) <span class="keyword">AS</span> LargestOrderPrice <span class="keyword">FROM</span> Orders</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th align="left">SmallestOrderPrice</th>
</tr>
</thead>
<tbody><tr>
<td align="left">100</td>
</tr>
</tbody></table>
<h3 id="SUM-函数"><a href="#SUM-函数" class="headerlink" title="SUM() 函数"></a>SUM() 函数</h3><p><code>SUM</code>函数返回数值列的总数（总额）</p>
<blockquote>
<p>SELECT SUM(column_name) FROM table_name</p>
</blockquote>
<p>例：我们希望查找“OrderPrice”字段的总数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUM</span>(OrderPrice) <span class="keyword">AS</span> OrderTotal <span class="keyword">FROM</span> Orders</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th align="left">OrderTotal</th>
</tr>
</thead>
<tbody><tr>
<td align="left">5700</td>
</tr>
</tbody></table>
<h3 id="GROUP-BY语句"><a href="#GROUP-BY语句" class="headerlink" title="GROUP BY语句"></a>GROUP BY语句</h3><p>合计函数（比如<code>SUM</code>）尝尝需要添加<code>GROUP BY</code>语句</p>
<p><code>GROUP BY</code>语句用于结合合计函数，根据一个或多个列对结果集进行分组</p>
<h4 id="SQL-GROUP-BY语法"><a href="#SQL-GROUP-BY语法" class="headerlink" title="SQL GROUP BY语法"></a>SQL GROUP BY语法</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name, aggregate_function(column_name)</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> column_name <span class="keyword">operator</span> <span class="keyword">value</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> column_name</span><br></pre></td></tr></table></figure>

<h4 id="SQL-GROUP-BY示例"><a href="#SQL-GROUP-BY示例" class="headerlink" title="SQL GROUP BY示例"></a>SQL GROUP BY示例</h4><p>现在，我们希望查找每个客户的总金额（总订单）</p>
<p>我们想要使用<code>GROUP BY</code>语句对客户进行组合。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Customer, <span class="keyword">SUM</span>(OrderPrice) <span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> Customer</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th align="left">Customer</th>
<th align="left">SUM(OrderPrice)</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Bush</td>
<td align="left">2000</td>
</tr>
<tr>
<td align="left">Carter</td>
<td align="left">1700</td>
</tr>
<tr>
<td align="left">Adams</td>
<td align="left">2000</td>
</tr>
</tbody></table>
<h4 id="GROUP-BY一个以上的列"><a href="#GROUP-BY一个以上的列" class="headerlink" title="GROUP BY一个以上的列"></a>GROUP BY一个以上的列</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Customer, OrderDate, <span class="keyword">SUM</span>(OrderPrice) <span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> Customer, OrderDate</span><br></pre></td></tr></table></figure>

<h3 id="HAVING子句"><a href="#HAVING子句" class="headerlink" title="HAVING子句"></a>HAVING子句</h3><p>在SQL中增加HAVING子句原因是，<code>WHERE</code>关键字无法与合计函数一起使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name, aggregate_function(column_name)</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> colum_name <span class="keyword">operator</span> <span class="keyword">value</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> column_name</span><br><span class="line"><span class="keyword">HAVING</span> aggregate_function(column_name) <span class="keyword">operator</span> <span class="keyword">value</span></span><br></pre></td></tr></table></figure>

<p>例1：我们希望查找订单总金额少于2000的客户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Customer, <span class="keyword">SUM</span>(OrderPrice) <span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> Customer</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">SUM</span>(OrderPrice) &lt; <span class="number">2000</span></span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th align="left">Customer</th>
<th align="left">SUM(OrderPrice)</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Carter</td>
<td align="left">1700</td>
</tr>
</tbody></table>
<p>例2：我们希望查找客户“Bush”或“Adams”拥有超过1500的订单总金额</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Customer, <span class="keyword">SUM</span>(OrderPrice) <span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">WHERE</span> Customer=<span class="string">'Bush'</span> <span class="keyword">OR</span> Customer=<span class="string">'Adams'</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> Customer</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">SUM</span>(OrderPrice) &gt; <span class="number">1500</span></span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th align="left">Customer</th>
<th align="left">SUM(OrderPrice)</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Bush</td>
<td align="left">2000</td>
</tr>
<tr>
<td align="left">Adams</td>
<td align="left">2000</td>
</tr>
</tbody></table>
<h3 id="UCASE-和LCASE-函数"><a href="#UCASE-和LCASE-函数" class="headerlink" title="UCASE()和LCASE()函数"></a>UCASE()和LCASE()函数</h3><p><code>UCASE</code>函数把字段的值转换为大写，<code>LCASE()</code>函数把字段的值转换为小写</p>
<blockquote>
<p>SELECT UCASE(column_name) FROM table_name</p>
</blockquote>
<p>”Persons“表</p>
<table>
<thead>
<tr>
<th align="left">Id</th>
<th align="left">LastName</th>
<th align="left">FirstName</th>
<th align="left">Address</th>
<th align="left">City</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">Adams</td>
<td align="left">John</td>
<td align="left">Oxford Street</td>
<td align="left">London</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">Bush</td>
<td align="left">George</td>
<td align="left">Fifth Avenue</td>
<td align="left">New York</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">Carter</td>
<td align="left">Thomas</td>
<td align="left">Changan Street</td>
<td align="left">Beijing</td>
</tr>
</tbody></table>
<p>现在，我们希望选取“LastName”和“FirstName”列的内容，然后把“LastName”列转换为大写</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">UCASE</span>(LastName) <span class="keyword">as</span> LastName, FirstName <span class="keyword">FROM</span>  Persons</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th align="left">LastName</th>
<th align="left">FirstName</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ADAMS</td>
<td align="left">John</td>
</tr>
<tr>
<td align="left">BUSH</td>
<td align="left">George</td>
</tr>
<tr>
<td align="left">CARTER</td>
<td align="left">Thomas</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LCASE</span>(LastName) <span class="keyword">as</span> LastName, FirstName <span class="keyword">FROM</span> Persons</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th align="left">LastName</th>
<th align="left">FirstName</th>
</tr>
</thead>
<tbody><tr>
<td align="left">adams</td>
<td align="left">John</td>
</tr>
<tr>
<td align="left">bush</td>
<td align="left">George</td>
</tr>
<tr>
<td align="left">carter</td>
<td align="left">Thomas</td>
</tr>
</tbody></table>
<h3 id="MID-函数"><a href="#MID-函数" class="headerlink" title="MID()函数"></a>MID()函数</h3><p><code>MID</code>函数用于从文本字段中提取字符</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MID</span>(column_name, <span class="keyword">start</span>[, <span class="keyword">length</span>] <span class="keyword">FROM</span> table_name)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>column_name</td>
<td>必需。要提取字符的字段</td>
</tr>
<tr>
<td>start</td>
<td>必需。规定开始位置（起始值是1）</td>
</tr>
<tr>
<td>length</td>
<td>可选。要返回的字符数。如果省略，则MID()函数返回剩余文本</td>
</tr>
</tbody></table>
<p>Persons表</p>
<table>
<thead>
<tr>
<th align="left">Id</th>
<th align="left">LastName</th>
<th align="left">FirstName</th>
<th align="left">Address</th>
<th align="left">City</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">Adams</td>
<td align="left">John</td>
<td align="left">Oxford Street</td>
<td align="left">London</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">Bush</td>
<td align="left">George</td>
<td align="left">Fifth Avenue</td>
<td align="left">New York</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">Carter</td>
<td align="left">Thomas</td>
<td align="left">Changan Street</td>
<td align="left">Beijing</td>
</tr>
</tbody></table>
<p>例1：我们希望从“City”列中提出前3个字符。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MID</span>(City, <span class="number">1</span>, <span class="number">3</span>) <span class="keyword">as</span> SmallCity Persons</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">SmallCity</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Lon</td>
</tr>
<tr>
<td align="left">New</td>
</tr>
<tr>
<td align="left">Bei</td>
</tr>
</tbody></table>
<h3 id="LEN-函数"><a href="#LEN-函数" class="headerlink" title="LEN()函数"></a>LEN()函数</h3><p><code>LEN</code>函数返回文本字段中值的长度</p>
<blockquote>
<p>SELECT LEN(column_name) FROM table_name</p>
</blockquote>
<p>Persons表同上：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LEN</span>(City) <span class="keyword">AS</span> LengthOfCity <span class="keyword">FROM</span> Persons</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th align="left">LengthOfCity</th>
</tr>
</thead>
<tbody><tr>
<td align="left">6</td>
</tr>
<tr>
<td align="left">8</td>
</tr>
<tr>
<td align="left">7</td>
</tr>
</tbody></table>
<h3 id="ROUND-函数"><a href="#ROUND-函数" class="headerlink" title="ROUND()函数"></a>ROUND()函数</h3><p><code>ROUND</code>函数用于把数值字段舍入为指定的小数位数</p>
<blockquote>
<p>SELECT ROUND(column_name, decimals) FROM table_name</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>column_name</td>
<td>必需。要舍入的字段</td>
</tr>
<tr>
<td>decimals</td>
<td>必需。规定要返回的小数位数</td>
</tr>
</tbody></table>
<p>Products表</p>
<table>
<thead>
<tr>
<th align="left">Prod_Id</th>
<th align="left">ProductName</th>
<th align="left">Unit</th>
<th align="left">UnitPrice</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">gold</td>
<td align="left">1000 g</td>
<td align="left">32.35</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">silver</td>
<td align="left">1000 g</td>
<td align="left">11.56</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">copper</td>
<td align="left">1000 g</td>
<td align="left">6.85</td>
</tr>
</tbody></table>
<p>例：把名称和价格舍入为最接近的整数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ProductName, <span class="keyword">ROUND</span>(UnitPrice, <span class="number">0</span>) <span class="keyword">AS</span> UnitPrice <span class="keyword">FROM</span> Products</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th align="left">ProductName</th>
<th align="left">UnitPrice</th>
</tr>
</thead>
<tbody><tr>
<td align="left">gold</td>
<td align="left">32</td>
</tr>
<tr>
<td align="left">silver</td>
<td align="left">12</td>
</tr>
</tbody></table>
<h3 id="NOW-函数"><a href="#NOW-函数" class="headerlink" title="NOW()函数"></a>NOW()函数</h3><p>NOW函数返回当前的日期和时间</p>
<p><strong>Tips：</strong>如果您在使用SQL Server数据库，请使用getdate()函数来获得当前的日期时间。</p>
<blockquote>
<p>SELECT NOW() FROM table_name</p>
</blockquote>
<p>例：表格同上，要求显示当天的日期所对应的名称和价格</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ProfuctName, UnitPrice, <span class="keyword">NOW</span>() <span class="keyword">as</span> PerDate <span class="keyword">FROM</span> Products</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th align="left">ProductName</th>
<th align="left">UnitPrice</th>
<th align="left">PerDate</th>
</tr>
</thead>
<tbody><tr>
<td align="left">gold</td>
<td align="left">32.35</td>
<td align="left">12/29/2008 11:36:05 AM</td>
</tr>
<tr>
<td align="left">silver</td>
<td align="left">11.56</td>
<td align="left">12/29/2008 11:36:05 AM</td>
</tr>
<tr>
<td align="left">copper</td>
<td align="left">6.85</td>
<td align="left">12/29/2008 11:36:05 AM</td>
</tr>
</tbody></table>
<h3 id="FORMAT-函数"><a href="#FORMAT-函数" class="headerlink" title="FORMAT()函数"></a>FORMAT()函数</h3><p>FORMAT()函数用于对字段的显示进行格式化</p>
<blockquote>
<p>SELECT FORMAT(column_name, format) FROM table_name</p>
</blockquote>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>column_name</td>
<td>必需。要规格式化的字段</td>
</tr>
<tr>
<td>format</td>
<td>必需。规定格式。</td>
</tr>
</tbody></table>
<p>表同上。</p>
<p>例：需要实现每天日期所对应的名称和价格（日期显示的格式为“YYYY-MM-DD”）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ProductName, UnitPrice, <span class="keyword">FORMAT</span>(<span class="keyword">NOW</span>(), <span class="string">'YYYY-MM-DD'</span>) <span class="keyword">AS</span> PerDate </span><br><span class="line"><span class="keyword">FROM</span> Product</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th align="left">ProductName</th>
<th align="left">UnitPrice</th>
<th align="left">PerDate</th>
</tr>
</thead>
<tbody><tr>
<td align="left">gold</td>
<td align="left">32.35</td>
<td align="left">12/29/2008</td>
</tr>
<tr>
<td align="left">silver</td>
<td align="left">11.56</td>
<td align="left">12/29/2008</td>
</tr>
<tr>
<td align="left">copper</td>
<td align="left">6.85</td>
<td align="left">12/29/2008</td>
</tr>
</tbody></table>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://woojoo520.github.io/2019/10/17/SQLServer-Day7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mariana">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Celery Fairy">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/17/SQLServer-Day7/" itemprop="url">SQLServer-Day7</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-17T19:42:29+08:00">
                2019-10-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="SQLServer-Day7"><a href="#SQLServer-Day7" class="headerlink" title="SQLServer-Day7"></a>SQLServer-Day7</h2><h3 id="DROP-INDEX语句"><a href="#DROP-INDEX语句" class="headerlink" title="DROP INDEX语句"></a>DROP INDEX语句</h3><p>可以使用<code>DROP INDEX</code>命令删除表格中的索引</p>
<p>用于 Microsoft SQLJet (以及 Microsoft Access) 的语法:</p>
<blockquote>
<p>DROP INDEX index_name ON table_name</p>
</blockquote>
<p>用于 MS SQL Server的语法</p>
<blockquote>
<p>DROP INDEX table_name.index_name</p>
</blockquote>
<p>用于IBM DB2 和 Oracle语法：</p>
<blockquote>
<p>DROP INDEX index_name</p>
</blockquote>
<p>用于MySQL的语法</p>
<blockquote>
<p>ALTER TABLE table_name DROP index_name</p>
</blockquote>
<h3 id="DROP-TABLE-语句"><a href="#DROP-TABLE-语句" class="headerlink" title="DROP TABLE 语句"></a>DROP TABLE 语句</h3><p>用于删除表（表的结构、属性以及索引也会被删除）</p>
<blockquote>
<p>DROP TABLE 表名称</p>
</blockquote>
<h3 id="DROP-DATABASE语句"><a href="#DROP-DATABASE语句" class="headerlink" title="DROP DATABASE语句"></a>DROP DATABASE语句</h3><p>用于删除数据库</p>
<blockquote>
<p>DROP DATABASE 数据库名称</p>
</blockquote>
<h3 id="TRUNCATE-TABLE语句"><a href="#TRUNCATE-TABLE语句" class="headerlink" title="TRUNCATE TABLE语句"></a>TRUNCATE TABLE语句</h3><p>如果我们仅仅需要删除表内的数据，但并不删除表本身，可以使用<code>TRUNCATE TABLE</code>命令，仅仅删除表格中的数据</p>
<blockquote>
<p>TRUNCATE TABLE 表名称</p>
</blockquote>
<h3 id="ALTER-TABLE语句"><a href="#ALTER-TABLE语句" class="headerlink" title="ALTER TABLE语句"></a>ALTER TABLE语句</h3><p>用于在已有的表中添加、修改或删除列</p>
<p>添加列：</p>
<blockquote>
<p>ALTER TABLE table_name</p>
<p>ADD column_name datatype</p>
</blockquote>
<p>删除列：</p>
<blockquote>
<p>ALTER TABLE table_name</p>
<p>DROP COLUMN column_name</p>
</blockquote>
<p><strong>Tips：</strong>某些数据库系统不允许这种在数据库表中删除列的方式</p>
<p>要更改表中列的数据类型：</p>
<blockquote>
<p>ALTER TABLE table_name</p>
<p>ALTER COLUMN column_name datatype</p>
</blockquote>
<p>例1：</p>
<p>原始的Persons表：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>LastName</th>
<th>FirstName</th>
<th>Address</th>
<th>City</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Adams</td>
<td>John</td>
<td>Oxford Street</td>
<td>London</td>
</tr>
<tr>
<td>2</td>
<td>Bush</td>
<td>George</td>
<td>Fifth Avenue</td>
<td>New York</td>
</tr>
<tr>
<td>3</td>
<td>Carter</td>
<td>Thomas</td>
<td>Changan Street</td>
<td>Beijing</td>
</tr>
</tbody></table>
<p>现在，需要在表“Persons”中添加一个名为“Birthday”的新列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">ADD</span> Birthday <span class="built_in">date</span></span><br></pre></td></tr></table></figure>

<p>请注意，新列 “Birthday” 的类型是 date，可以存放日期。数据类型规定列中可以存放的数据的类型。</p>
<p>所以，新的表长这样：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>LastName</th>
<th>FirstName</th>
<th>Address</th>
<th>City</th>
<th>Birthday</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Adams</td>
<td>John</td>
<td>Oxford Street</td>
<td>London</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>Bush</td>
<td>George</td>
<td>Fifth Avenue</td>
<td>New York</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>Carter</td>
<td>Thomas</td>
<td>Changan Street</td>
<td>Beijing</td>
<td></td>
</tr>
</tbody></table>
<p>例2：改变数据类型实例</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> Birthday <span class="keyword">year</span></span><br></pre></td></tr></table></figure>

<p>例3：删除Birthday列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons </span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">COLUMN</span> Birthday</span><br></pre></td></tr></table></figure>

<h3 id="AUTO-INCREMENT-字段"><a href="#AUTO-INCREMENT-字段" class="headerlink" title="AUTO INCREMENT 字段"></a>AUTO INCREMENT 字段</h3><p>会在新纪录插入表示生成一个唯一的数字</p>
<p>我们通常希望在每次插入记录时，自动创建主键字段的值，这时候，可以在表中创建一个auto-increament字段</p>
<p>用于MySQL的语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE</span><br><span class="line">(</span><br><span class="line">P_Id int NOT NULL AUTO_INCREAMENT, </span><br><span class="line">LastName varchar(255) NOT NULL, </span><br><span class="line">FirstName varcahr(255), </span><br><span class="line">Address varcahr(255), </span><br><span class="line">City varcahr(255), </span><br><span class="line">PRIMARY KEY (P_Id)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>上面的语句把“Persons”表中的P_Id列定义为auto-increament主键，默认的，AUTO_INCREAMENT的开始值是1，每条新纪录递增1</p>
<p>要让AUTO_INCREAMENT序列以其他的值起始，需要这样使用SQL语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE Persons AUTO_INCREAMENT=100</span><br></pre></td></tr></table></figure>

<p>要在“Persons”表中插入新纪录，我们不必为“P_Id”列规定值（会自动添加一个唯一的值）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO Persons (FirstName, LastName)</span><br><span class="line">VALUES (&apos;Bill&apos;, &apos;Gates&apos;)</span><br></pre></td></tr></table></figure>

<p>用于SQL Serer的语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span></span><br><span class="line">(</span><br><span class="line">P_Id <span class="built_in">int</span> PRIMARY <span class="keyword">KEY</span> <span class="keyword">IDENTITY</span>, </span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>, </span><br><span class="line">FirstName varcahr(<span class="number">255</span>), </span><br><span class="line">Address varcahr(<span class="number">255</span>), </span><br><span class="line">City varcahr(<span class="number">255</span>), </span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (P_Id)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>若要规定“P_Id”列以20起始且递增10，请把identity改为<code>IDENTITY(20, 10)</code></p>
<p>用于Access的语法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE</span><br><span class="line">(</span><br><span class="line">P_Id int PRIMARY KEY AUTOINCREAMENT, </span><br><span class="line">LastName varchar(255) NOT NULL, </span><br><span class="line">FirstName varcahr(255), </span><br><span class="line">Address varcahr(255), </span><br><span class="line">City varcahr(255), </span><br><span class="line">PRIMARY KEY (P_Id)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>修改起始值与增量，同SQL Server</p>
<p>用于Oracle的语法：</p>
<p>稍微复杂一点，必须通过sequence 对创建auto-increament字段(该对象生成数字序列)</p>
<p>CREATE SEQUENCE</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE SEQUENCE seq_person</span><br><span class="line">MINVALUE 1</span><br><span class="line">START WITH 1</span><br><span class="line">INCREASE BY1</span><br><span class="line">CACHE 10</span><br></pre></td></tr></table></figure>

<p>上面的代码创建名为seq_person的序列对象，它以1起始且以1递增。该对象缓存10个值以提高性能。CACHE选项规定了为了提高访问速度要储存多少个序列值</p>
<p>要在“Persons”表中插入新纪录，必须使用nextval函数（该函数从seq_person）序列中取回下一个值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO Persons(P_Id, FirstName, LastName)</span><br><span class="line">VALUES (seq_person.nextval, &apos;Lars&apos;, &apos;Monsen&apos;)</span><br></pre></td></tr></table></figure>

<p>“P_Id” 的赋值是来自 seq_person 序列的下一个数字</p>
<h3 id="Date函数"><a href="#Date函数" class="headerlink" title="Date函数"></a>Date函数</h3><h4 id="SQL日期"><a href="#SQL日期" class="headerlink" title="SQL日期"></a>SQL日期</h4><p>当我们处理日期时，最难的任务恐怕是确保所插入的日期的格式，与数据库中日期列的格式相匹配</p>
<p>只要数据包含的只是日期部分，运行查询就不会出问题。但是，如果涉及时间，情况就有点复杂了</p>
<p>在讨论日期查询的复杂性之前，先看看内置日期的处理函数</p>
<h4 id="MySQL-Date函数"><a href="#MySQL-Date函数" class="headerlink" title="MySQL Date函数"></a>MySQL Date函数</h4><table>
<thead>
<tr>
<th>函数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>NOW()</td>
<td>返回当前的时间和日期</td>
</tr>
<tr>
<td>CURDATE()</td>
<td>返回当前的日期</td>
</tr>
<tr>
<td>CURTIME()</td>
<td>返回当前的时间</td>
</tr>
<tr>
<td>DATE()</td>
<td>提取日期或日期/时间表达式的部分日期</td>
</tr>
<tr>
<td>EXTRATE()</td>
<td>返回日期/时间按的单独部分</td>
</tr>
<tr>
<td>DATE_ADD()</td>
<td>给日期添加指定的时间间隔</td>
</tr>
<tr>
<td>DATE_SUB()</td>
<td>从日期减去指定的时间间隔</td>
</tr>
<tr>
<td>DATEDIFF()</td>
<td>返回两个日期之间的天数</td>
</tr>
<tr>
<td>DATE_FORMAT()</td>
<td>用不同的格式显示日期/时间</td>
</tr>
</tbody></table>
<h4 id="SQL-Server-Date函数"><a href="#SQL-Server-Date函数" class="headerlink" title="SQL Server Date函数"></a>SQL Server Date函数</h4><table>
<thead>
<tr>
<th>函数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>GETDATE()</td>
<td>返回当前日期和时间</td>
</tr>
<tr>
<td>DATEPART()</td>
<td>返回日期/时间的单独部分</td>
</tr>
<tr>
<td>DATEADD()</td>
<td>在日期中添加或减去指定的时间间隔</td>
</tr>
<tr>
<td>DATEDIFF()</td>
<td>返回两个日期之间的时间</td>
</tr>
<tr>
<td>CONVERT()</td>
<td>用不同的格式显示日期/时间</td>
</tr>
</tbody></table>
<h4 id="SQL-Date-数据类型"><a href="#SQL-Date-数据类型" class="headerlink" title="SQL Date 数据类型"></a>SQL Date 数据类型</h4><p>MySQL 使用下列数据类型在数据库中存储日期或日期/时间值：</p>
<ul>
<li>DATE - 格式 YYYY-MM-DD</li>
<li>DATETIME - 格式 YYYY-MM-DD HH:MM:SS</li>
<li>TIMESTAMP - 格式 YYYY-MM-DD HH:MM:SS</li>
<li>YEAR - 格式 YYYY 或 YY</li>
</ul>
<p>SQL Server 使用下列数据类型在数据库中存储日期或日期/时间值</p>
<ul>
<li>DATE - 格式 YYYY-MM-DD</li>
<li>DATETIME - 格式 YYYY-MM-DD HH:MM:SS</li>
<li>SMALLDATETIME- 格式 YYYY-MM-DD HH:MM:SS</li>
<li>TIMESTAMP - 格式 唯一的数字</li>
</ul>
<h4 id="日期处理"><a href="#日期处理" class="headerlink" title="日期处理"></a>日期处理</h4><p>如果不涉及时间部分，可以轻松的比较两个日期</p>
<p>比如，有下面这个”Orders”表：</p>
<table>
<thead>
<tr>
<th>OrderId</th>
<th>ProductName</th>
<th>OrderDate</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>computer</td>
<td>2008-12-26</td>
</tr>
<tr>
<td>2</td>
<td>printer</td>
<td>2008-12-26</td>
</tr>
<tr>
<td>3</td>
<td>electrograph</td>
<td>2008-11-12</td>
</tr>
<tr>
<td>4</td>
<td>telephone</td>
<td>2008-10-19</td>
</tr>
</tbody></table>
<p>希望获取OrderDate为“2008-12-26”的记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM Orders WHERE OrderDate = &apos;2008-12-16&apos;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th>OrderId</th>
<th>ProductName</th>
<th>OrderDate</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>computer</td>
<td>2008-12-26</td>
</tr>
<tr>
<td>2</td>
<td>printer</td>
<td>2008-12-26</td>
</tr>
</tbody></table>
<p>如果Orders表长成这样：</p>
<table>
<thead>
<tr>
<th>OrderId</th>
<th>ProductName</th>
<th>OrderDate</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>computer</td>
<td>2008-12-26 16:23:55</td>
</tr>
<tr>
<td>2</td>
<td>printer</td>
<td>2008-12-26 10:45：26</td>
</tr>
<tr>
<td>3</td>
<td>electrograph</td>
<td>2008-11-12 14:12:08</td>
</tr>
<tr>
<td>4</td>
<td>telephone</td>
<td>2008-10-19 12:56:10</td>
</tr>
</tbody></table>
<p>依然使用上面的语句，将得不到结果，因为该查询不含有时间部分的日期</p>
<p><strong>Tips：</strong>如果希望使查询简单并且更容易维护，那么尽量不要使用时间部分</p>
<h3 id="NULL值"><a href="#NULL值" class="headerlink" title="NULL值"></a>NULL值</h3><p>NULL值是一楼的位置数据</p>
<p>默认的，表的列可以存放NULL值</p>
<h4 id="SQL-NULL值"><a href="#SQL-NULL值" class="headerlink" title="SQL NULL值"></a>SQL NULL值</h4><p>如果表中的某个列是可选的，那么可以在不向改列添加值的情况下插入新记录或更新已有记录，这意味着该字段将以NULL值保存</p>
<p>NULL值的处理方式与其他值不同</p>
<p>NULL用作为止的或不适用的值的占位符</p>
<p><strong>Tips：</strong>无法比较NULL 和 0，他们是不等价的</p>
<p>无法使用比较运算符来测试NULL值，比如<code>=</code>， <code>&lt;</code>或者<code>&lt;&gt;</code></p>
<p>必须使用 <code>IS NULL</code>和<code>IS NOT NULL</code>操作符</p>
<h4 id="SQL-IS-NULL"><a href="#SQL-IS-NULL" class="headerlink" title="SQL IS NULL"></a>SQL IS NULL</h4><p>Persons表</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>LastName</th>
<th>FirstName</th>
<th>Address</th>
<th>City</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Adams</td>
<td>John</td>
<td></td>
<td>London</td>
</tr>
<tr>
<td>2</td>
<td>Bush</td>
<td>George</td>
<td>Fifth Avenue</td>
<td>New York</td>
</tr>
<tr>
<td>3</td>
<td>Carter</td>
<td>Thomas</td>
<td></td>
<td>Beijing</td>
</tr>
</tbody></table>
<p>仅仅选取在“Address”列中带有NULL值的记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> LastName, FirstName, Address <span class="keyword">FROM</span> Persons</span><br><span class="line"><span class="keyword">WHERE</span> Address <span class="keyword">IS</span> <span class="literal">NULL</span></span><br></pre></td></tr></table></figure>

<p><strong>Tips:</strong> 只能使用<code>IS NULL</code>来查找NULL值</p>
<h4 id="SQL-IS-NOT-NULL"><a href="#SQL-IS-NOT-NULL" class="headerlink" title="SQL IS NOT NULL"></a>SQL IS NOT NULL</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> LastName, FirstName, Address <span class="keyword">FROM</span> Persons</span><br><span class="line"><span class="keyword">WHERE</span> Address <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br></pre></td></tr></table></figure>

<h3 id="NULL函数"><a href="#NULL函数" class="headerlink" title="NULL函数"></a>NULL函数</h3><p>Products表:</p>
<table>
<thead>
<tr>
<th>P_Id</th>
<th>ProductName</th>
<th>UnitPrice</th>
<th>UnitsInStock</th>
<th>UnitsOnOrder</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>computer</td>
<td>699</td>
<td>25</td>
<td>15</td>
</tr>
<tr>
<td>2</td>
<td>printer</td>
<td>365</td>
<td>36</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>telephone</td>
<td>280</td>
<td>159</td>
<td>57</td>
</tr>
</tbody></table>
<p>假设“UnitsOnOrder”是可选的，而且可以包含NULL值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ProductName, UnitPrices*(UnitsInStock+UnitsOnOrder)</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br></pre></td></tr></table></figure>

<p>在上面的例子中，如果有“UnitOnOrder”值是NULL，那么结果是NULL</p>
<p>微软的<code>ISNULL()</code>函数用于规定如何处理NULL值</p>
<p><code>NVL()</code>, <code>IFNULL()</code>和<code>COALESCE()</code>函数也可以达到相同的结果</p>
<h4 id="SQL-Server-MS-Access"><a href="#SQL-Server-MS-Access" class="headerlink" title="SQL Server / MS Access"></a>SQL Server / MS Access</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ProductName, UnitPrice*(UnitsInStock+<span class="keyword">ISNULL</span>(UnitsOnOrder, <span class="number">0</span>))</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br></pre></td></tr></table></figure>

<h4 id="Oracle"><a href="#Oracle" class="headerlink" title="Oracle"></a>Oracle</h4><p>Oracle没有<code>ISNULL()</code>函数，但是可以使用<code>NVL()</code>函数达到相同的效果</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ProductName, UnitPrice*(UnitsInStock+NVL(UnitsOnOrder, <span class="number">0</span>))</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br></pre></td></tr></table></figure>

<h4 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT ProductName, UnitPrice*(UnitsInStock+IFNULL(UnitsOnOrder, 0))</span><br><span class="line">FROM Products</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT ProductName,UnitPrice*(UnitsInStock+COALESCE(UnitsOnOrder,0))</span><br><span class="line">FROM Products</span><br></pre></td></tr></table></figure>

<h3 id="SQL-Server数据类型"><a href="#SQL-Server数据类型" class="headerlink" title="SQL Server数据类型"></a>SQL Server数据类型</h3><h4 id="Character字符串："><a href="#Character字符串：" class="headerlink" title="Character字符串："></a>Character字符串：</h4><table>
<thead>
<tr>
<th>数据类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>char(n)</td>
<td>固定长度的字符串，最多8000个字符</td>
</tr>
<tr>
<td>varchar(n)</td>
<td>可变长度的字符串，最多8000个字符</td>
</tr>
<tr>
<td>varchar(max)</td>
<td>可变长度的字符串，最多1,073,741,824个字符</td>
</tr>
<tr>
<td>text</td>
<td>可变长度的字符串，最多2GB字符数据</td>
</tr>
</tbody></table>
<h4 id="UniCode字符串"><a href="#UniCode字符串" class="headerlink" title="UniCode字符串"></a>UniCode字符串</h4><table>
<thead>
<tr>
<th>数据类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>nchar(n)</td>
<td>固定长度的Unicode 数据，最多4000个字符</td>
</tr>
<tr>
<td>nvarchar(n)</td>
<td>可变长度的Unicode 数据，最多4000个字符</td>
</tr>
<tr>
<td>nvarchar(max)</td>
<td>可变长度的Unicode 数据，最多536,870,912个字符</td>
</tr>
<tr>
<td>ntext</td>
<td>可变长度的Unicode 数据，最多2GB字符数据</td>
</tr>
</tbody></table>
<h4 id="Binary类型"><a href="#Binary类型" class="headerlink" title="Binary类型"></a>Binary类型</h4><table>
<thead>
<tr>
<th>数据类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>bit</td>
<td>允许0、1或NULL</td>
</tr>
<tr>
<td>binary(n)</td>
<td>固定长度的二进制数据。最多 8,000 字节。</td>
</tr>
<tr>
<td>varbinary(n)</td>
<td>可变长度的二进制数据。最多 8,000 字节。</td>
</tr>
<tr>
<td>varbinary(max)可变</td>
<td>可变长度的二进制数据。最多 2GB字节。</td>
</tr>
<tr>
<td>image</td>
<td>可变长度的二进制数据。最多 2GB。</td>
</tr>
</tbody></table>
<h4 id="Number类型"><a href="#Number类型" class="headerlink" title="Number类型"></a>Number类型</h4><table>
<thead>
<tr>
<th align="left">数据类型</th>
<th align="left">描述</th>
<th align="left">存储</th>
</tr>
</thead>
<tbody><tr>
<td align="left">tinyint</td>
<td align="left">允许从 0 到 255 的所有数字。</td>
<td align="left">1 字节</td>
</tr>
<tr>
<td align="left">smallint</td>
<td align="left">允许从 -32,768 到 32,767 的所有数字。</td>
<td align="left">2 字节</td>
</tr>
<tr>
<td align="left">int</td>
<td align="left">允许从 -2,147,483,648 到 2,147,483,647 的所有数字。</td>
<td align="left">4 字节</td>
</tr>
<tr>
<td align="left">bigint</td>
<td align="left">允许介于 -9,223,372,036,854,775,808 和 9,223,372,036,854,775,807 之间的所有数字。</td>
<td align="left">8 字节</td>
</tr>
<tr>
<td align="left">decimal(p,s)</td>
<td align="left">固定精度和比例的数字。允许从 -10^38 +1 到 10^38 -1 之间的数字。p 参数指示可以存储的最大位数（小数点左侧和右侧）。p 必须是 1 到 38 之间的值。默认是 18。s 参数指示小数点右侧存储的最大位数。s 必须是 0 到 p 之间的值。默认是 0。</td>
<td align="left">5-17 字节</td>
</tr>
<tr>
<td align="left">numeric(p,s)</td>
<td align="left">固定精度和比例的数字。允许从 -10^38 +1 到 10^38 -1 之间的数字。p 参数指示可以存储的最大位数（小数点左侧和右侧）。p 必须是 1 到 38 之间的值。默认是 18。s 参数指示小数点右侧存储的最大位数。s 必须是 0 到 p 之间的值。默认是 0。</td>
<td align="left">5-17 字节</td>
</tr>
<tr>
<td align="left">smallmoney</td>
<td align="left">介于 -214,748.3648 和 214,748.3647 之间的货币数据。</td>
<td align="left">4 字节</td>
</tr>
<tr>
<td align="left">money</td>
<td align="left">介于 -922,337,203,685,477.5808 和 922,337,203,685,477.5807 之间的货币数据。</td>
<td align="left">8 字节</td>
</tr>
<tr>
<td align="left">float(n)</td>
<td align="left">从 -1.79E + 308 到 1.79E + 308 的浮动精度数字数据。 参数 n 指示该字段保存 4 字节还是 8 字节。float(24) 保存 4 字节，而 float(53) 保存 8 字节。n 的默认值是 53。</td>
<td align="left">4 或 8 字节</td>
</tr>
<tr>
<td align="left">real</td>
<td align="left">从 -3.40E + 38 到 3.40E + 38 的浮动精度数字数据。</td>
<td align="left">4 字节</td>
</tr>
</tbody></table>
<h4 id="Date-类型："><a href="#Date-类型：" class="headerlink" title="Date 类型："></a>Date 类型：</h4><table>
<thead>
<tr>
<th align="left">数据类型</th>
<th align="left">描述</th>
<th align="left">存储</th>
</tr>
</thead>
<tbody><tr>
<td align="left">datetime</td>
<td align="left">从 1753 年 1 月 1 日 到 9999 年 12 月 31 日，精度为 3.33 毫秒。</td>
<td align="left">8 bytes</td>
</tr>
<tr>
<td align="left">datetime2</td>
<td align="left">从 1753 年 1 月 1 日 到 9999 年 12 月 31 日，精度为 100 纳秒。</td>
<td align="left">6-8 bytes</td>
</tr>
<tr>
<td align="left">smalldatetime</td>
<td align="left">从 1900 年 1 月 1 日 到 2079 年 6 月 6 日，精度为 1 分钟。</td>
<td align="left">4 bytes</td>
</tr>
<tr>
<td align="left">date</td>
<td align="left">仅存储日期。从 0001 年 1 月 1 日 到 9999 年 12 月 31 日。</td>
<td align="left">3 bytes</td>
</tr>
<tr>
<td align="left">time</td>
<td align="left">仅存储时间。精度为 100 纳秒。</td>
<td align="left">3-5 bytes</td>
</tr>
<tr>
<td align="left">datetimeoffset</td>
<td align="left">与 datetime2 相同，外加时区偏移。</td>
<td align="left">8-10 bytes</td>
</tr>
<tr>
<td align="left">timestamp</td>
<td align="left">存储唯一的数字，每当创建或修改某行时，该数字会更新。timestamp 基于内部时钟，不对应真实时间。每个表只能有一个 timestamp 变量。</td>
<td align="left"></td>
</tr>
</tbody></table>
<h4 id="其他数据类型："><a href="#其他数据类型：" class="headerlink" title="其他数据类型："></a>其他数据类型：</h4><table>
<thead>
<tr>
<th align="left">数据类型</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">sql_variant</td>
<td align="left">存储最多 8,000 字节不同数据类型的数据，除了 text、ntext 以及 timestamp。</td>
</tr>
<tr>
<td align="left">uniqueidentifier</td>
<td align="left">存储全局标识符 (GUID)。</td>
</tr>
<tr>
<td align="left">xml</td>
<td align="left">存储 XML 格式化数据。最多 2GB。</td>
</tr>
<tr>
<td align="left">cursor</td>
<td align="left">存储对用于数据库操作的指针的引用。</td>
</tr>
<tr>
<td align="left">table</td>
<td align="left">存储结果集，供稍后处理。</td>
</tr>
</tbody></table>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://woojoo520.github.io/2019/10/15/SQLServer-Day6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mariana">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Celery Fairy">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/15/SQLServer-Day6/" itemprop="url">SQLServer-Day6</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-15T11:58:00+08:00">
                2019-10-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="SQLServer-Day6"><a href="#SQLServer-Day6" class="headerlink" title="SQLServer-Day6"></a>SQLServer-Day6</h2><h3 id="UNIQUE-约束"><a href="#UNIQUE-约束" class="headerlink" title="UNIQUE 约束"></a>UNIQUE 约束</h3><p><code>UNIQUE</code>约束唯一表示数据库中的每条记录</p>
<p><code>UNIQUE</code>和<code>PRIMARY KEY</code> 约束均为列或列集合提供了唯一性的保证</p>
<p><code>PRIMARY KEY</code>拥有自动定义的<code>UNIQUE</code>约束</p>
<p><strong>Tips：</strong>每个表可以有多个<code>UNIQUE</code>约束，但是每个表只能有一个<code>PRIMARY KEY</code>约束</p>
<h4 id="SQL-UNIQUE-Constraint-on-CREATE-TABLE"><a href="#SQL-UNIQUE-Constraint-on-CREATE-TABLE" class="headerlink" title="SQL UNIQUE Constraint on CREATE TABLE"></a>SQL UNIQUE Constraint on CREATE TABLE</h4><p>例1：下面的SQL在“Persons”表创建时在“Id_P”列创建<code>UNIQUE</code>约束</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>, </span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>, </span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>), </span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>), </span><br><span class="line"><span class="keyword">UNIQUE</span> (Id_P)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>SQL Server / Oracle / MS Access:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">UNIQUE</span>, </span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>, </span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>), </span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>如果需要命名UNIQUE约束，以及为多个列定义UNIQUE约束，需要使用下面的SQL语句。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>, </span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>, </span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>), </span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> uc_PersonID <span class="keyword">UNIQUE</span> (Id_P, LastName)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="SQL-UNIQUE-Constraint-on-ALTER-TABLE"><a href="#SQL-UNIQUE-Constraint-on-ALTER-TABLE" class="headerlink" title="SQL UNIQUE Constraint on ALTER TABLE"></a>SQL UNIQUE Constraint on ALTER TABLE</h4><p>当表已被创建时，如需在“Id_P”列创建UNIQUE约束是，可以这样：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">UNIQUE</span>(Id_P)</span><br></pre></td></tr></table></figure>

<p>如需要命名UNIQUE约束，并定义多个列的UNIQUE约束，这样：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> uc_PersonID <span class="keyword">UNIQUE</span> (Id_P, LastName)</span><br></pre></td></tr></table></figure>

<h4 id="撤销UNIQUE约束"><a href="#撤销UNIQUE约束" class="headerlink" title="撤销UNIQUE约束"></a>撤销UNIQUE约束</h4><p>MySQL:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> uc_PersonID</span><br></pre></td></tr></table></figure>

<p>SQL Server / Oracle / MS Access</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> uc_PersonID</span><br></pre></td></tr></table></figure>

<h3 id="PRIMARY-KEY"><a href="#PRIMARY-KEY" class="headerlink" title="PRIMARY KEY"></a>PRIMARY KEY</h3><p><code>PRIMARY KEY</code>约束唯一标识数据库中的每条记录</p>
<p>主键必须包含唯一的值</p>
<p>主键列不能包含NULL值</p>
<p>每个表都应该有一个主键，并且每个表只能有一个主键</p>
<p>用法同上，不赘述了</p>
<h3 id="FOREIGN-KEY"><a href="#FOREIGN-KEY" class="headerlink" title="FOREIGN KEY"></a>FOREIGN KEY</h3><p>一个表中的FOREIGN KEY指向另一个表中的PRIMARY KEY</p>
<p>举个例子：</p>
<p>Persons</p>
<table>
<thead>
<tr>
<th>Id_P</th>
<th>LastName</th>
<th>FirstName</th>
<th>Address</th>
<th>City</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Adams</td>
<td>John</td>
<td>Oxford Street</td>
<td>London</td>
</tr>
<tr>
<td>2</td>
<td>Bush</td>
<td>George</td>
<td>Fifth Avenue</td>
<td>New York</td>
</tr>
<tr>
<td>3</td>
<td>Carter</td>
<td>Thomas</td>
<td>Changan Street</td>
<td>Beijing</td>
</tr>
</tbody></table>
<p>Orders：</p>
<table>
<thead>
<tr>
<th>Id_O</th>
<th>OrderNo</th>
<th>Id_P</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>77895</td>
<td>3</td>
</tr>
<tr>
<td>2</td>
<td>44678</td>
<td>3</td>
</tr>
<tr>
<td>3</td>
<td>22456</td>
<td>1</td>
</tr>
<tr>
<td>4</td>
<td>24562</td>
<td>1</td>
</tr>
</tbody></table>
<p>请注意，”Orders“中的“Id_P”列指向“Persons”表中的“Id_P”列</p>
<p>“Persons”表中的“Id_P”列是“Persons”表中的<code>PRIMARY KEY</code></p>
<p>“Orders”表中的“Id_P”列是“Orders”表中的<code>FOREIGN KEY</code></p>
<p><code>FOREIGN KEY</code>约束用来预防破坏表之间连接的动作</p>
<p><code>FOREIGN KEY</code>约束也能防止非法数据插入外键列，因为它必须是它指向的那个表中的值之一。</p>
<h4 id="SQL-FOREIGN-KEY-Constraint-on-CREATE-TABLE"><a href="#SQL-FOREIGN-KEY-Constraint-on-CREATE-TABLE" class="headerlink" title="SQL FOREIGN KEY Constraint on CREATE TABLE"></a>SQL FOREIGN KEY Constraint on CREATE TABLE</h4><p>例：在创建”Orders”表时为“Id_P”列创建<code>FOREIGN KEY</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_O <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>, </span><br><span class="line">OrderNo <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>, </span><br><span class="line">Id_P <span class="built_in">int</span>, </span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (Id_O), </span><br><span class="line"><span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (Id_P) <span class="keyword">REFERENCES</span> Persons(Id_P)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>SQL Server / Oracle / MS Access:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Orders</span><br><span class="line">(</span><br><span class="line">Id_O <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY <span class="keyword">KEY</span>, </span><br><span class="line">OrderNo <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>, </span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> <span class="keyword">REFERENCES</span> Persons(Id_P)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>如果需要命名FOREIGN KEY约束，以及为多个列定义FOREIGN KEY约束，需要使用以下SQL语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Orders</span><br><span class="line">(</span><br><span class="line">Id_O <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>, </span><br><span class="line">OrderNo <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>, </span><br><span class="line">Id_P <span class="built_in">int</span>, </span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (Id_O), </span><br><span class="line"><span class="keyword">CONSTRAINT</span> fk_PreOrders <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (Id_P) </span><br><span class="line"><span class="keyword">REFERENCE</span> Person(Id_P)  </span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>在ALTER TABLE的时候，与之前的样例相似，不赘述了。</p>
<h3 id="CHECK-约束"><a href="#CHECK-约束" class="headerlink" title="CHECK 约束"></a>CHECK 约束</h3><p>CHECK约束用于限制列中的值的范围</p>
<p>如果对单个列定义CHECK约束，那么该列只允许特定的值</p>
<p>如果对一个表定义CHECK约束，那么此约束会在特定的列中对值进行限制。</p>
<p>SQL CHECK Constraint on CREATE TABLE</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>, </span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>), </span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>), </span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line"><span class="keyword">CHECK</span> (Id_P &gt; <span class="number">0</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>SQL Server / Oracle / MS Access：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">CHECK</span> (Id_P &gt; <span class="number">0</span>), </span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>), </span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>), </span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="DEFAULT-约束"><a href="#DEFAULT-约束" class="headerlink" title="DEFAULT 约束"></a>DEFAULT 约束</h3><p>DEFAULT约束用于向列中插入默认值</p>
<p>如果没有规定其他的值，那么会将默认值添加到所有的新纪录</p>
<h4 id="SQL-DEFAULT-Constraint-on-CREATE-TABLE"><a href="#SQL-DEFAULT-Constraint-on-CREATE-TABLE" class="headerlink" title="SQL DEFAULT Constraint on CREATE  TABLE"></a>SQL DEFAULT Constraint on CREATE  TABLE</h4><p>下面的 SQL 在 “Persons” 表创建时为 “City” 列创建 DEFAULT 约束：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>, </span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>), </span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>), </span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">'Sandnes'</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>通过使用类似GETDATE()这样的函数，DEFAULT约束可以用于插入系统值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Orders</span><br><span class="line">(</span><br><span class="line">Id_O <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>, </span><br><span class="line">OrderNo <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>, </span><br><span class="line">Id_P <span class="built_in">int</span>, </span><br><span class="line">OrderDate <span class="built_in">date</span> <span class="keyword">DEFAULT</span> <span class="keyword">GETDATE</span>()</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="SQL-DEFAULT-Constraint-on-ALTER-TABLE"><a href="#SQL-DEFAULT-Constraint-on-ALTER-TABLE" class="headerlink" title="SQL DEFAULT Constraint on ALTER TABLE"></a>SQL DEFAULT Constraint on ALTER TABLE</h3><p>MySQL: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE Persons</span><br><span class="line">ALTER City SET DEFAULT &apos;SANDNES&apos;</span><br></pre></td></tr></table></figure>

<p>SQL Server / Oracle / MS Access：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> City <span class="keyword">SET</span> <span class="keyword">DEFAULT</span> <span class="string">'SANDNES'</span></span><br></pre></td></tr></table></figure>

<h4 id="撤销DEFAULT约束"><a href="#撤销DEFAULT约束" class="headerlink" title="撤销DEFAULT约束"></a>撤销DEFAULT约束</h4><p>MySQL：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE Persons </span><br><span class="line">ALTER City DROP DEFAULT</span><br></pre></td></tr></table></figure>

<p>SQL Server / Oracle / MS Access：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">COLUMN</span> City <span class="keyword">DROP</span> <span class="keyword">DEFAULT</span></span><br></pre></td></tr></table></figure>

<h3 id="CREATE-INDEX-语句"><a href="#CREATE-INDEX-语句" class="headerlink" title="CREATE INDEX 语句"></a>CREATE INDEX 语句</h3><p>用于在表中创建索引</p>
<p>在不读取整个表的情况下，索引使数据库应用程序可以发更快地查找数据</p>
<p><strong>索引:</strong></p>
<p>我们可以在表中创建索引，以便更加快速高效地查询数据</p>
<p>用户无法看到索引，它们只能被用来加速搜索/查询</p>
<p><strong>Tips：</strong>更新一个包含索引的表需要比更新一个没有索引的表更多的时间，这是由于索引本身也需要更新。因此，理想的做法是仅仅在常常被搜索的列（以及表）上面创建索引。</p>
<h4 id="SQL-CREATE-INDEX语法"><a href="#SQL-CREATE-INDEX语法" class="headerlink" title="SQL CREATE INDEX语法"></a>SQL CREATE INDEX语法</h4><blockquote>
<p>CREATE INDEX index_name</p>
<p>ON table_name (column_name)</p>
</blockquote>
<p><strong>Tips：</strong>“column_name”规定需要索引的列</p>
<h4 id="SQL-CREATE-UNIQUE-INDEX语法"><a href="#SQL-CREATE-UNIQUE-INDEX语法" class="headerlink" title="SQL CREATE UNIQUE INDEX语法"></a>SQL CREATE UNIQUE INDEX语法</h4><p>在表上创建一个唯一的索引。唯一的索引意味着两个行不能拥有相同的索引值。</p>
<blockquote>
<p>CREATE UNIQUE INDEX index_name</p>
<p>ON table_name(column_name)</p>
</blockquote>
<p>例：创建一个简单的索引，名为“PersonIndex”， 在Person表的LastName列：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> PersonIndex</span><br><span class="line"><span class="keyword">ON</span> Person (LastName)</span><br></pre></td></tr></table></figure>

<p>如果希望以<strong>降序</strong>索引某个列中的值，可以在列名称之后添加保留字<strong>DECS</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> PersonIndex</span><br><span class="line"><span class="keyword">ON</span> Person (LastName <span class="keyword">DESC</span>)</span><br></pre></td></tr></table></figure>

<p>如果希望索引不止一个列，可以在括号中列出这些列的名称，用逗号隔开：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> PersonInde, </span><br><span class="line"><span class="keyword">ON</span> Person(LastName, FirstName)</span><br></pre></td></tr></table></figure>

<h3 id="182-查找重复的电子邮箱"><a href="#182-查找重复的电子邮箱" class="headerlink" title="182. 查找重复的电子邮箱"></a>182. 查找重复的电子邮箱</h3><p>编写一个 SQL 查询，查找 Person 表中所有重复的电子邮箱。</p>
<p>示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+----+---------+</span><br><span class="line">| Id | Email   |</span><br><span class="line">+----+---------+</span><br><span class="line">| 1  | a@b.com |</span><br><span class="line">| 2  | c@d.com |</span><br><span class="line">| 3  | a@b.com |</span><br><span class="line">+----+---------+</span><br></pre></td></tr></table></figure>

<p>根据以上输入，你的查询应返回以下结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+---------+</span><br><span class="line">| Email   |</span><br><span class="line">+---------+</span><br><span class="line">| a@b.com |</span><br><span class="line">+---------+</span><br></pre></td></tr></table></figure>

<p>我写的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT DISTINCT A.Email </span><br><span class="line">FROM Person AS A, Person AS B</span><br><span class="line">WHERE A.Id &lt;&gt; B.Id AND A.Email = B.Email</span><br></pre></td></tr></table></figure>

<p>参考别人的：</p>
<p>方法一：使用<code>GROUP BY</code>和临时表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SECECT Email FROM </span><br><span class="line">(</span><br><span class="line">SELECT Email, COUNT(Email) as num </span><br><span class="line">FROM Person</span><br><span class="line">GROUP BY Email</span><br><span class="line">) as statistic</span><br><span class="line">WHERE num &gt; 1</span><br></pre></td></tr></table></figure>

<p>方法二：使用GROUP BY和HAVING条件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT Email</span><br><span class="line">FROM Person</span><br><span class="line">GROUP BY Email </span><br><span class="line">HAVING COUNT (Email) &gt; 1</span><br></pre></td></tr></table></figure>

<h3 id="176-第二高的薪水"><a href="#176-第二高的薪水" class="headerlink" title="176. 第二高的薪水"></a>176. 第二高的薪水</h3><p>编写一个 SQL 查询，获取 Employee 表中第二高的薪水（Salary） 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+----+--------+</span><br><span class="line">| Id | Salary |</span><br><span class="line">+----+--------+</span><br><span class="line">| 1  | 100    |</span><br><span class="line">| 2  | 200    |</span><br><span class="line">| 3  | 300    |</span><br><span class="line">+----+--------+</span><br></pre></td></tr></table></figure>

<p>例如上述 Employee 表，SQL查询应该返回 200 作为第二高的薪水。如果不存在第二高的薪水，那么查询应返回 null。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+</span><br><span class="line">| SecondHighestSalary |</span><br><span class="line">+---------------------+</span><br><span class="line">| 200                 |</span><br><span class="line">+---------------------+</span><br></pre></td></tr></table></figure>

<p>方法一：先去掉最高的，然后查找剩余中最高的，同时解决了如果在表中找不到第二高的薪水的情况。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT max(Salary) AS SecondHighestSalary </span><br><span class="line">FROM Employee </span><br><span class="line">WHERE Salary &lt;&gt; </span><br><span class="line">(</span><br><span class="line">    SELECT max(Salary) </span><br><span class="line">    FROM Employee</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>方法二：按不同的薪资降序排序，然后使用LIMIT 子句获得的二高的薪资</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">    (SELECT DISTINCT Salary </span><br><span class="line">    FROM Employee</span><br><span class="line">    ORDER BY Salary DESC</span><br><span class="line">    LIMIT 1 OFFSET 1) AS SecondHighestSalary；</span><br></pre></td></tr></table></figure>

<p>方法二：使用IFNULL和LIMIT子句</p>
<p>解决NULL问题的另一个方法就是使用IFNUL函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT IFNULL(</span><br><span class="line">    (SELECT DISTINCT Salary </span><br><span class="line">     FROM Person </span><br><span class="line">     ORDER BY Salary DESC</span><br><span class="line">     LIMIT 1 OFFSET 1),</span><br><span class="line">NULL) AS SecondHighestSalary</span><br></pre></td></tr></table></figure>

<h3 id="620-有趣的电影"><a href="#620-有趣的电影" class="headerlink" title="620. 有趣的电影"></a>620. 有趣的电影</h3><p>某城市开了一家新的电影院，吸引了很多人过来看电影。该电影院特别注意用户体验，专门有个 LED显示板做电影推荐，上面公布着影评和相关电影描述。</p>
<p>作为该电影院的信息部主管，您需要编写一个 SQL查询，找出所有影片描述为非 boring (不无聊) 的并且 id 为奇数 的影片，结果请按等级 rating 排列。</p>
<p>例如，下表 cinema:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">|   id    | movie     |  description |  rating   |</span><br><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">|   1     | War       |   great 3D   |   8.9     |</span><br><span class="line">|   2     | Science   |   fiction    |   8.5     |</span><br><span class="line">|   3     | irish     |   boring     |   6.2     |</span><br><span class="line">|   4     | Ice song  |   Fantacy    |   8.6     |</span><br><span class="line">|   5     | House card|   Interesting|   9.1     |</span><br><span class="line">+---------+-----------+--------------+-----------+</span><br></pre></td></tr></table></figure>

<p>对于上面的例子，则正确的输出是为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">|   id    | movie     |  description |  rating   |</span><br><span class="line">+---------+-----------+--------------+-----------+</span><br><span class="line">|   5     | House card|   Interesting|   9.1     |</span><br><span class="line">|   1     | War       |   great 3D   |   8.9     |</span><br><span class="line">+---------+-----------+--------------+-----------+</span><br></pre></td></tr></table></figure>

<p>Code：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM cinema </span><br><span class="line">WHERE mod(id, 2) = 1 AND description != &apos;boring&apos;</span><br><span class="line">ORDER BY rating DESC</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://woojoo520.github.io/2019/10/14/SQLServer-Day5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mariana">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Celery Fairy">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/14/SQLServer-Day5/" itemprop="url">SQLServer-Day5</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-14T20:17:37+08:00">
                2019-10-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="SQLServer-Day5"><a href="#SQLServer-Day5" class="headerlink" title="SQLServer-Day5"></a>SQLServer-Day5</h2><h3 id="UNION-操作符"><a href="#UNION-操作符" class="headerlink" title="UNION 操作符"></a>UNION 操作符</h3><p><code>UNION</code>操作符用于合并两个或多个SELECT语句的结果集</p>
<p>请注意，<code>UNION</code>内部的<code>SELECT</code>语句必须拥有相同数量的列。列也必须拥有相似的数据类型。同时，每条<code>SELECT</code>语句中的列的顺序必须相同。</p>
<blockquote>
<p>SELECT column_name(s)  FROM table_name1</p>
<p><strong>UNION</strong></p>
<p>SELECT column_name(s) FROM table_name2</p>
</blockquote>
<p><strong>Tips</strong>：默认地，<code>UNION</code>操作符取不同的值，如果允许重复的值，需使用<code>UNION ALL</code></p>
<blockquote>
<p>SELECT column_name(s)  FROM table_name1</p>
<p><strong>UNION ALL</strong></p>
<p>SELECT column_name(s) FROM table_name2</p>
</blockquote>
<p>另外，<code>UNION</code>结果集中的列名总是等于<code>UNION中</code>第一个<code>SELECT</code>语句中的列名</p>
<p>原始表：</p>
<p>Employees_China：</p>
<table>
<thead>
<tr>
<th>E_ID</th>
<th>E_Name</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>Zhang, Hua</td>
</tr>
<tr>
<td>02</td>
<td>Wang, Wei</td>
</tr>
<tr>
<td>03</td>
<td>Carter, Thomas</td>
</tr>
<tr>
<td>04</td>
<td>Yang, Ming</td>
</tr>
</tbody></table>
<p>Employees_USA:</p>
<table>
<thead>
<tr>
<th>E_ID</th>
<th>E_Name</th>
</tr>
</thead>
<tbody><tr>
<td>01</td>
<td>Adam, John</td>
</tr>
<tr>
<td>02</td>
<td>Bush, George</td>
</tr>
<tr>
<td>03</td>
<td>Carter, Thomas</td>
</tr>
<tr>
<td>04</td>
<td>Gates, Bill</td>
</tr>
</tbody></table>
<p>例：</p>
<p>列出所有在中国和美国的不同的雇员名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> E_Name</span><br><span class="line"><span class="keyword">FROM</span> Employees_China</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">FROM</span> Employees_USA</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th>E_Name</th>
</tr>
</thead>
<tbody><tr>
<td>Zhang, Hua</td>
</tr>
<tr>
<td>Wang, Wei</td>
</tr>
<tr>
<td>Carter, Thomas</td>
</tr>
<tr>
<td>Yang, Ming</td>
</tr>
<tr>
<td>Adam, John</td>
</tr>
<tr>
<td>Bush, George</td>
</tr>
<tr>
<td>Gates, Bill</td>
</tr>
</tbody></table>
<p>注释：这个命令无法列出在中国和美国的所有雇员，因为<code>UNION</code>命令只会选取不同的值。</p>
<h3 id="SELECT-INTO语句"><a href="#SELECT-INTO语句" class="headerlink" title="SELECT INTO语句"></a>SELECT INTO语句</h3><p>用于创建表的备份复件</p>
<p><code>SELECT INTO</code> 语句从一个表中选取数据，然后把数据插入另一个表中</p>
<p><code>SELECT INTO</code> 语句常用于创建表的备份文件或者用于对记录进行存档</p>
<p>可以将所有的列插入列表：</p>
<blockquote>
<p>SELECT *</p>
<p>INTO new_table_name [IN externaldatabase]</p>
<p>FROM old_tablename</p>
</blockquote>
<p>或者只把希望的列插入列表：</p>
<blockquote>
<p>SELECT column_name(s)</p>
<p>INTO new_table_name [IN externaldatabase]</p>
<p>FROM old_tablename</p>
</blockquote>
<h5 id="例：下面的例子会制作“Persons”表的备份复件"><a href="#例：下面的例子会制作“Persons”表的备份复件" class="headerlink" title="例：下面的例子会制作“Persons”表的备份复件"></a>例：下面的例子会制作“Persons”表的备份复件</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">INTO</span> Persons_backup</span><br><span class="line"><span class="keyword">FROM</span> Persons</span><br></pre></td></tr></table></figure>

<h5 id="IN子句可用于向另一个数据库中拷贝表："><a href="#IN子句可用于向另一个数据库中拷贝表：" class="headerlink" title="IN子句可用于向另一个数据库中拷贝表："></a>IN子句可用于向另一个数据库中拷贝表：</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">INTO</span> Persons <span class="keyword">IN</span> <span class="string">'Backup.mdb'</span></span><br><span class="line"><span class="keyword">FROM</span> Persons</span><br></pre></td></tr></table></figure>

<h5 id="如果我们希望拷贝某些域，可以在SELECT语句后列出这些域："><a href="#如果我们希望拷贝某些域，可以在SELECT语句后列出这些域：" class="headerlink" title="如果我们希望拷贝某些域，可以在SELECT语句后列出这些域："></a>如果我们希望拷贝某些域，可以在SELECT语句后列出这些域：</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  LastName, FIrstName</span><br><span class="line"><span class="keyword">INTO</span> Persons_backup</span><br><span class="line"><span class="keyword">FROM</span> Persons</span><br></pre></td></tr></table></figure>

<h5 id="带有WHERE子句："><a href="#带有WHERE子句：" class="headerlink" title="带有WHERE子句："></a>带有WHERE子句：</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> LastName, FirstName</span><br><span class="line"><span class="keyword">INTO</span> Persons_backup</span><br><span class="line"><span class="keyword">FROM</span> Persons</span><br><span class="line"><span class="keyword">WHERE</span> City = <span class="string">'Beijing'</span></span><br></pre></td></tr></table></figure>

<p>表示从“Pesons”表中提取居住在“Beijing”的人的信息，创建了一个带有两个列的名为“Persons_backup”的表</p>
<h5 id="被连接的表"><a href="#被连接的表" class="headerlink" title="被连接的表"></a>被连接的表</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Persons.LastName, Orders.OrderNo</span><br><span class="line"><span class="keyword">INTO</span> Persons_Order_Backup</span><br><span class="line"><span class="keyword">FROM</span> Persons</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> Orders</span><br><span class="line"><span class="keyword">ON</span> Persons.Id_P = Orders.Id_P</span><br></pre></td></tr></table></figure>

<p>表示创建一个名为“Persons_Order_Backup”的新表，其中包含了从Persons和Orders两个表中的内容。</p>
<h3 id="CREATE-DATABASE-语句"><a href="#CREATE-DATABASE-语句" class="headerlink" title="CREATE DATABASE 语句"></a>CREATE DATABASE 语句</h3><p>用于创建数据库</p>
<blockquote>
<p>CREATE DATABASE database_name</p>
</blockquote>
<p>例：创建一个名为my_db的数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> my_db</span><br></pre></td></tr></table></figure>

<p>可以通过<code>CREATE TABLE</code>来添加数据库表</p>
<h3 id="CREATE-TABLE-语句"><a href="#CREATE-TABLE-语句" class="headerlink" title="CREATE TABLE 语句"></a>CREATE TABLE 语句</h3><p>用于创建数据库中的表</p>
<blockquote>
<p>CREATE TABLE 表名称 </p>
<p>(</p>
<p>列名称1 数据类型，</p>
<p>列名称2 数据类型，</p>
<p>列名称3 数据类型，</p>
<p>…</p>
<p>)</p>
</blockquote>
<p>数据类型(data_type) 规定了列可容纳何种数据类型。下面的表格包含了SQL中最常用的数据类型</p>
<table>
<thead>
<tr>
<th>数据类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>interger(size)  <br>int(size)<br>smallint(size)<br>tinyint(size)</td>
<td>仅容纳整数，在括号内规定数字的最大位数</td>
</tr>
<tr>
<td>decimal(size, d)<br>numeric(size, d)</td>
<td>容纳带有小数的数字<br>“size”规定数字的最大位数。“d”规定小数点右侧的最大位数</td>
</tr>
<tr>
<td>char(size)</td>
<td>容纳固定长度的字符串（可容纳字母、数字以及特殊字符）<br>在括号中规定字符串的最大长度</td>
</tr>
<tr>
<td>varchar(size)</td>
<td>容纳可变长度的字符串（可容纳字母、数字以及特殊字符）<br>在括号中规定字符串的最大长度</td>
</tr>
<tr>
<td>date（yyyymmdd）</td>
<td>容纳日期</td>
</tr>
</tbody></table>
<p>例：</p>
<p>创建”Persons”表，其中包含5个列，列明分别是“Id_P”, “LastName”, “FirstName”, “Address”以及“City”</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span>, </span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>), </span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>), </span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>), </span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>空的表类似这样</p>
<table>
<thead>
<tr>
<th>Id_P</th>
<th>LastName</th>
<th>FirstName</th>
<th>Address</th>
<th>City</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>可使用INSERT INTO语句向空表写入数据</p>
<h3 id="SQL-约束（Constraints）"><a href="#SQL-约束（Constraints）" class="headerlink" title="SQL 约束（Constraints）"></a>SQL 约束（Constraints）</h3><p>约束用于限制加入表的数据的类型</p>
<p>可以在创建表时规定约束（通过<code>CREATE TABLE</code>语句），或者在表创建之后也可以（通过<code>ALTER TABLE</code>语句）</p>
<p>主要有以下几种约束：</p>
<ul>
<li>NOT NULL</li>
<li>UNIQUE</li>
<li>PRIMARY KEY</li>
<li>FOREIGN KEY</li>
<li>CHECK</li>
<li>DEFAULT</li>
</ul>
<h3 id="NOT-NULL约束"><a href="#NOT-NULL约束" class="headerlink" title="NOT NULL约束"></a>NOT NULL约束</h3><p><code>NOT NULL</code>约束强制列不接受<code>NULL</code>值</p>
<p><code>NOT NULL</code>约束强制字段始终包含值。这意味着，如果不向字段添加值，就无法插入新记录或者更新记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Persons</span><br><span class="line">(</span><br><span class="line">Id_P <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>, </span><br><span class="line">LastName <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>, </span><br><span class="line">FirstName <span class="built_in">varchar</span>(<span class="number">255</span>), </span><br><span class="line">Address <span class="built_in">varchar</span>(<span class="number">255</span>), </span><br><span class="line">City <span class="built_in">varchar</span>(<span class="number">255</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://woojoo520.github.io/2019/10/13/SQLServer-Day4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mariana">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Celery Fairy">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/13/SQLServer-Day4/" itemprop="url">SQLServer-Day4</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-13T15:22:53+08:00">
                2019-10-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="SQLServer-Day4"><a href="#SQLServer-Day4" class="headerlink" title="SQLServer-Day4"></a>SQLServer-Day4</h2><h3 id="IN操作符"><a href="#IN操作符" class="headerlink" title="IN操作符"></a><code>IN</code>操作符</h3><p>允许我们在<code>WHERE</code>子句中规定多个值</p>
<blockquote>
<p>SELECT column_name(s)</p>
<p>FROM table_name</p>
<p>WHERE column_name IN (value1, value2, …)</p>
</blockquote>
<p>原始的Persons表：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>LastName</th>
<th>FirstName</th>
<th>Address</th>
<th>City</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Adams</td>
<td>John</td>
<td>Oxford Street</td>
<td>London</td>
</tr>
<tr>
<td>2</td>
<td>Bush</td>
<td>George</td>
<td>Fifth Avenue</td>
<td>New York</td>
</tr>
<tr>
<td>3</td>
<td>Carter</td>
<td>Thomas</td>
<td>Changan Street</td>
<td>Beijing</td>
</tr>
</tbody></table>
<p>例：寻找姓氏为Adams和Carter的人</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * </span><br><span class="line"><span class="keyword">FROM</span> Persons</span><br><span class="line"><span class="keyword">WHERE</span> LastName <span class="keyword">IN</span> (<span class="string">'Adams'</span>, <span class="string">'Carter'</span>)</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>LastName</th>
<th>FirstName</th>
<th>Address</th>
<th>City</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Adams</td>
<td>John</td>
<td>Oxford Street</td>
<td>London</td>
</tr>
<tr>
<td>3</td>
<td>Carter</td>
<td>Thomas</td>
<td>Changan Street</td>
<td>Beijing</td>
</tr>
</tbody></table>
<h3 id="BETWEEN操作符"><a href="#BETWEEN操作符" class="headerlink" title="BETWEEN操作符"></a><code>BETWEEN</code>操作符</h3><p>在<code>WHERE</code>子句中使用，作用是选取介于两个值之间的数据范围。</p>
<p>操作符<code>BETWEEN ... AND</code>会选取介于两个值之间的数据范围。这些值可以是数据、文本或者日期。</p>
<blockquote>
<p><strong>SELECT</strong> column_name(s)</p>
<p><strong>FROM</strong> table_name</p>
<p><strong>WHERE</strong> column_name</p>
<p><strong>BETWEEN</strong> value1 <strong>AND</strong> value2</p>
</blockquote>
<p>原始的Persons表：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>LastName</th>
<th>FirstName</th>
<th>Address</th>
<th>City</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Adams</td>
<td>John</td>
<td>Oxford Street</td>
<td>London</td>
</tr>
<tr>
<td>2</td>
<td>Bush</td>
<td>George</td>
<td>Fifth Avenue</td>
<td>New York</td>
</tr>
<tr>
<td>3</td>
<td>Carter</td>
<td>Thomas</td>
<td>Changan Street</td>
<td>Beijing</td>
</tr>
<tr>
<td>4</td>
<td>Gates</td>
<td>Bill</td>
<td>Xuanwumen 10</td>
<td>Beijing</td>
</tr>
</tbody></table>
<p>例：寻找以字母顺序介于‘Adams’（包括）和‘Carter’（不包括）之间的人：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> Persons</span><br><span class="line"><span class="keyword">WHERE</span> LastName</span><br><span class="line"><span class="keyword">BETWEEN</span> <span class="string">'Adams'</span> <span class="keyword">AND</span> <span class="string">'Carter'</span></span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>LastName</th>
<th>FirstName</th>
<th>Address</th>
<th>City</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Adams</td>
<td>John</td>
<td>Oxford Street</td>
<td>London</td>
</tr>
<tr>
<td>2</td>
<td>Bush</td>
<td>George</td>
<td>Fifth Avenue</td>
<td>New York</td>
</tr>
</tbody></table>
<p><strong>重要事项：</strong>不同数据库对<code>BETWEEN...AND</code>操作符的处理方式是有差异的。某些数据库会列出介于‘Adams’和‘Carter’的人，但不包括‘Adams’和‘Carter’；某些数据库会列出介于 ‘Adams’和‘Carter’之间并包括‘Adams’和‘Carter’的人；而另一些数据库会列出介于‘Adams’和‘Carter’之间的人，包括‘Adams’，但不包括‘Carter’</p>
<p>所以，需要检查自己的数据库是如何处理<code>BETWEEN...AND</code>操作符的</p>
<p>例2：如果需要显示该范围之外的人，需要使用<code>NOT</code>操作符：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * </span><br><span class="line"><span class="keyword">FROM</span> Persons </span><br><span class="line"><span class="keyword">WHERE</span> LastName</span><br><span class="line"><span class="keyword">NOT</span> <span class="keyword">BETWEEN</span> <span class="string">'Adams'</span> <span class="keyword">AND</span> <span class="string">'Carter'</span></span><br></pre></td></tr></table></figure>

<h3 id="Alias-别名"><a href="#Alias-别名" class="headerlink" title="Alias (别名)"></a>Alias (别名)</h3><p>可以为列名称和表名称指定别名（Alias）</p>
<h4 id="表的SQL-Alias语法"><a href="#表的SQL-Alias语法" class="headerlink" title="表的SQL Alias语法"></a>表的SQL Alias语法</h4><blockquote>
<p>SELECT column_name(s)</p>
<p>FROM table_name </p>
<p><strong>AS</strong> alias_name</p>
</blockquote>
<h4 id="列的SQL-Alias语法"><a href="#列的SQL-Alias语法" class="headerlink" title="列的SQL Alias语法"></a>列的SQL Alias语法</h4><blockquote>
<p>SELECT column_name <strong>AS</strong> alias_name</p>
<p>FROM table_name</p>
</blockquote>
<p>例：使用表名称别名</p>
<p>假设我们有两个表分别是：”Persons” 和 “Product_Orders”。我们分别为它们指定别名 “p” 和 “po”。</p>
<p>现在，我们希望列出 “John Adams” 的所有定单。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> po.OrderID, p.LastName, p.FirstName</span><br><span class="line"><span class="keyword">FROM</span> Persons, Product_Orders</span><br><span class="line"><span class="keyword">WHERE</span> p.LastName = <span class="string">'Adams'</span> <span class="keyword">AND</span> p.FirstName = <span class="string">'John'</span></span><br></pre></td></tr></table></figure>

<p>如果不使用别名：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Persons.OrderID, Product_Orders.LastName, Product_Orders.FirstName</span><br><span class="line"><span class="keyword">FROM</span> Persons, Product_Orders</span><br><span class="line"><span class="keyword">WHERE</span> Product_Orders.LastName = <span class="string">'Adams'</span> <span class="keyword">AND</span> Product_Orders.FirstName = <span class="string">'John'</span></span><br></pre></td></tr></table></figure>

<p>例：</p>
<p>Persons表：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>LastName</th>
<th>FirstName</th>
<th>Address</th>
<th>City</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Adams</td>
<td>John</td>
<td>Oxford Street</td>
<td>London</td>
</tr>
<tr>
<td>2</td>
<td>Bush</td>
<td>George</td>
<td>Fifth Avenue</td>
<td>New York</td>
</tr>
<tr>
<td>3</td>
<td>Carter</td>
<td>Thomas</td>
<td>Changan Street</td>
<td>Beijing</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> LastName <span class="keyword">AS</span> Family, FirstName <span class="keyword">as</span> <span class="keyword">Name</span></span><br><span class="line"><span class="keyword">FROM</span> Persons</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th>Family</th>
<th>FirstName</th>
</tr>
</thead>
<tbody><tr>
<td>Adams</td>
<td>John</td>
</tr>
<tr>
<td>Bush</td>
<td>George</td>
</tr>
<tr>
<td>Carter</td>
<td>Thomas</td>
</tr>
</tbody></table>
<p><strong>注意：这里的列的名称也发生了改变！</strong></p>
<h3 id="JOIN"><a href="#JOIN" class="headerlink" title="JOIN"></a>JOIN</h3><p><code>join</code>用于根据两个或多个表中的列之间的关系，从这些表中查询数据</p>
<h4 id="Join和Key"><a href="#Join和Key" class="headerlink" title="Join和Key"></a>Join和Key</h4><p>有时，为了得到完整的结果，我们需要从两个或更多的表中获取数据，我们就需要执行join</p>
<p>数据库中的表可通过键值将彼此联系起来。主键（Primary Key）是一个列，在这个列中的每一行的值都是唯一的。在表中，每个主键的值都是唯一的。这样说的目的是在不重复每个表中的所有数据的情况下，把表间的数据交叉捆绑在一起。</p>
<p>例如，Persons表</p>
<table>
<thead>
<tr>
<th>Id_P</th>
<th>LastName</th>
<th>FirstName</th>
<th>Address</th>
<th>City</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Adams</td>
<td>John</td>
<td>Oxford Street</td>
<td>London</td>
</tr>
<tr>
<td>2</td>
<td>Bush</td>
<td>George</td>
<td>Fifth Avenue</td>
<td>New York</td>
</tr>
<tr>
<td>3</td>
<td>Carter</td>
<td>Thomas</td>
<td>Changan Street</td>
<td>Beijing</td>
</tr>
</tbody></table>
<p>这里：<strong>Id_P</strong>是Persons表中的主键，这意味着没有两行能够拥有相同的<code>Id_P</code></p>
<p>Orders表：</p>
<table>
<thead>
<tr>
<th>Id_O</th>
<th>OrderNo</th>
<th>Id_P</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>77895</td>
<td>3</td>
</tr>
<tr>
<td>2</td>
<td>44678</td>
<td>3</td>
</tr>
<tr>
<td>3</td>
<td>22456</td>
<td>1</td>
</tr>
<tr>
<td>4</td>
<td>24562</td>
<td>1</td>
</tr>
<tr>
<td>5</td>
<td>34764</td>
<td>65</td>
</tr>
</tbody></table>
<p>注意：“<strong>Id_O</strong>“列值Orders表中的主键，同时，”Orders“表中的”Id_P“列用于引用”Persons“表中的人，而无需使用他人的确切姓名</p>
<p>这个时候“Id_P”列把上面两个表联系起来了</p>
<p><strong>引用两个表</strong>，我们可以知道谁订购了什么产品？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Persons.LastName, Persons.FirstName, Orders.No</span><br><span class="line"><span class="keyword">FROM</span> Persons, Orders</span><br><span class="line"><span class="keyword">WHERE</span> Persons.Id_P = Orders.Id_P</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th>LastName</th>
<th>FirstName</th>
<th>OrderNo</th>
</tr>
</thead>
<tbody><tr>
<td>Adams</td>
<td>John</td>
<td>22456</td>
</tr>
<tr>
<td>Adams</td>
<td>John</td>
<td>24562</td>
</tr>
<tr>
<td>Carter</td>
<td>Thomas</td>
<td>77895</td>
</tr>
<tr>
<td>Carter</td>
<td>Thomas</td>
<td>44678</td>
</tr>
</tbody></table>
<p>除了上面的方法，我们还可以使用关键字<code>JOIN</code>来从两个表中获取数据</p>
<p>如果我们希望列出所有人的订购，可以这样写：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Persons.LastName, Persons.FirstName, Orders.OrderNo</span><br><span class="line"><span class="keyword">FROM</span> Persons</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> Orders</span><br><span class="line"><span class="keyword">ON</span> Persons.Id_P = Orders.Id_P</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> Persons.LastName</span><br></pre></td></tr></table></figure>

<p>不同的SQL JOIN</p>
<p>除了上面使用的<code>INNER JOIN</code>（内连接），还有其他的连接方式</p>
<ul>
<li><code>JOIN</code>：如果表中至少有一个匹配，则返回</li>
<li><code>LEFT JOIN</code>：即使右表中没有匹配，也从左表返回所有的行</li>
<li><code>RIGHT JOIN</code>：即使左表中没有匹配，也从右表中返回所有的行</li>
<li><code>FULL JOIN</code>：只要其中一个表中存在匹配，就返回行</li>
</ul>
<h3 id="INNER-JOIN-关键字"><a href="#INNER-JOIN-关键字" class="headerlink" title="INNER JOIN 关键字"></a>INNER JOIN 关键字</h3><p>在表中至少存在一个匹配项时，INNER JOIN关键字返回行</p>
<blockquote>
<p>SELECT column_name(s)</p>
<p>FROM table_name1</p>
<p><strong>INNER JOIN</strong> table_name2</p>
<p><strong>ON</strong> table_name1.column_name = table_name2.column_name</p>
</blockquote>
<p>注释：<code>INNER JOIN</code>和<code>JOIN</code>是相同的</p>
<p>如果在”Persons“中的行在“Orders”中没有匹配，则不会返回</p>
<h3 id="LEFT-JOIN关键字"><a href="#LEFT-JOIN关键字" class="headerlink" title="LEFT JOIN关键字"></a>LEFT JOIN关键字</h3><p><code>LEFT JOIN</code>关键字会从左表（table_name1）那里返回所有的行，即使在右表（table_name2）中没有匹配</p>
<blockquote>
<p>SELECT column_name(s)</p>
<p>FROM table_name1</p>
<p><strong>LEFT JOIN</strong> table_name2</p>
<p><strong>ON</strong> table_name1.column_name = table_name2.column_name</p>
</blockquote>
<p>注释：在某些数据库中，<code>LEFT JOIN</code> 称为 <code>LEFT OUTER JOIN</code></p>
<p>如果在上述的Persons表和Orders表中采用左连接，即：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Persons.LastName, Persons.FirstName, Orders,OrderNo</span><br><span class="line"><span class="keyword">FROM</span> Persons </span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Orders</span><br><span class="line"><span class="keyword">ON</span> Persons.Id_P = Orders.Id_P</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> Persons.LastName</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th>LastName</th>
<th>FirstName</th>
<th>OrderNo</th>
</tr>
</thead>
<tbody><tr>
<td>Adams</td>
<td>John</td>
<td>22456</td>
</tr>
<tr>
<td>Adams</td>
<td>John</td>
<td>24562</td>
</tr>
<tr>
<td>Carter</td>
<td>Thomas</td>
<td>77895</td>
</tr>
<tr>
<td>Carter</td>
<td>Thomas</td>
<td>44678</td>
</tr>
<tr>
<td>Bush</td>
<td>George</td>
<td></td>
</tr>
</tbody></table>
<h3 id="RIGHT-JOIN-关键字"><a href="#RIGHT-JOIN-关键字" class="headerlink" title="RIGHT JOIN 关键字"></a>RIGHT JOIN 关键字</h3><p><code>RIGHT JOIN</code>关键字会在右表（table_name2）那里返回所有的行，即使在左表（table_name1）中没有匹配的行</p>
<blockquote>
<p>SELECT column_name(s)</p>
<p>FROM table_name1</p>
<p><strong>RIGHT JOIN</strong> table_name2</p>
<p><strong>ON</strong> table_name1.column_name = table_name2.column_name</p>
</blockquote>
<p>还是上面那两张表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Persons.LastName, Persons.FirstName, Orders.OrderNo</span><br><span class="line"><span class="keyword">FROM</span> Persons </span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> Orders</span><br><span class="line"><span class="keyword">ON</span> Persons.Id_P = Orders.Id_P</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> Persons.LastName</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th>LastName</th>
<th>FirstName</th>
<th>OrderNo</th>
</tr>
</thead>
<tbody><tr>
<td>Adams</td>
<td>John</td>
<td>22456</td>
</tr>
<tr>
<td>Adams</td>
<td>John</td>
<td>24562</td>
</tr>
<tr>
<td>Carter</td>
<td>Thomas</td>
<td>77895</td>
</tr>
<tr>
<td>Carter</td>
<td>Thomas</td>
<td>44678</td>
</tr>
<tr>
<td></td>
<td></td>
<td>34764</td>
</tr>
</tbody></table>
<p><code>RIGHT JOIN</code>关键字会从右表（Orders）那里返回所有的行，即使在左表（Persons）中没有匹配的行</p>
<h3 id="FULL-JOIN-关键字"><a href="#FULL-JOIN-关键字" class="headerlink" title="FULL JOIN 关键字"></a>FULL JOIN 关键字</h3><p>只要其中某个表存在匹配，<code>FULL JOIN</code>关键字就回返回行</p>
<blockquote>
<p>SELECT column_name(s)</p>
<p>FROM table_name1</p>
<p><strong>FULL JOIN</strong> table_name2</p>
<p><strong>ON</strong> table_name1.column_name = table_name2.column_name</p>
</blockquote>
<p>Persons表和Orders表同上</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Persons.LastName, Persons.FirstName, Orders.OrderNo</span><br><span class="line"><span class="keyword">FROM</span> Persons</span><br><span class="line"><span class="keyword">FULL</span> <span class="keyword">JOIN</span> Orders</span><br><span class="line"><span class="keyword">ON</span> Persons.Id_P = Orders.Id_P</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> Persons.LastName</span><br></pre></td></tr></table></figure>

<p>结果</p>
<table>
<thead>
<tr>
<th>LastName</th>
<th>FirstName</th>
<th>OrderNo</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>Adams</td>
<td>John</td>
<td>22456</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Adams</td>
<td>John</td>
<td>24562</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Carter</td>
<td>Thomas</td>
<td>77895</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Carter</td>
<td>Thomas</td>
<td>44678</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Bush</td>
<td>George</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>34764</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><code>FLLL JOIN</code>关键字会从左表（Persons）和右表（Orders）那里返回所有的行。如果“Persons”中的行在表“Orders”中没有匹配，或者如果“Orders”中的行在表“Persons”中没有匹配，这些行同样会列出。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://woojoo520.github.io/2019/10/12/SQLServer-Day3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mariana">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Celery Fairy">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/10/12/SQLServer-Day3/" itemprop="url">SQLServer-Day3</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-12T13:11:24+08:00">
                2019-10-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="SQLServer—Day3"><a href="#SQLServer—Day3" class="headerlink" title="SQLServer—Day3"></a>SQLServer—Day3</h2><h3 id="TOP子句"><a href="#TOP子句" class="headerlink" title="TOP子句"></a>TOP子句</h3><p><code>TOP</code>子句用于规定要返回的记录的数目（并非所有的数据库系统都支持TOP子句）</p>
<blockquote>
<p>SELECT TOP number | percent column_name(s)</p>
<p>FROM table_name</p>
</blockquote>
<p><code>MySQL</code>和<code>Oracle</code>中的SQL <code>SELECT TOP</code>是等价的</p>
<p>MySQL语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT column_name(s)</span><br><span class="line">FROM table_name</span><br><span class="line">LIMIT number</span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM Persons</span><br><span class="line">LIMIT 5</span><br></pre></td></tr></table></figure>

<p>Oracle语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s)</span><br><span class="line"><span class="keyword">FROM</span> table_name </span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">ROWNUM</span> &lt;= <span class="built_in">number</span></span><br></pre></td></tr></table></figure>

<p>例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> Persons </span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">ROWNUM</span> &lt;= <span class="number">5</span></span><br></pre></td></tr></table></figure>

<p>原始表 Persons表：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>LastName</th>
<th>FirstName</th>
<th>Address</th>
<th>City</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Adams</td>
<td>John</td>
<td>Oxford Street</td>
<td>London</td>
</tr>
<tr>
<td>2</td>
<td>Bush</td>
<td>George</td>
<td>Fifth Avenue</td>
<td>New York</td>
</tr>
<tr>
<td>3</td>
<td>Carter</td>
<td>Thomas</td>
<td>Changan Street</td>
<td>Beijing</td>
</tr>
<tr>
<td>4</td>
<td>Obama</td>
<td>Barack</td>
<td>Pennsylvania Avenue</td>
<td>Washington</td>
</tr>
</tbody></table>
<p>例1：从上面的Persons表中选取头两条记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TOP <span class="number">2</span> * <span class="keyword">FROM</span> Persons</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>LastName</th>
<th>FirstName</th>
<th>Address</th>
<th>City</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Adams</td>
<td>John</td>
<td>Oxford Street</td>
<td>London</td>
</tr>
<tr>
<td>2</td>
<td>Bush</td>
<td>George</td>
<td>Fifth Avenue</td>
<td>New York</td>
</tr>
</tbody></table>
<p>例2：从Persons表中选取50%的记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TOP <span class="number">50</span> <span class="keyword">PERCENT</span> * <span class="keyword">FROM</span> Persons</span><br></pre></td></tr></table></figure>

<p>结果同上述</p>
<h3 id="LIKE操作符"><a href="#LIKE操作符" class="headerlink" title="LIKE操作符"></a>LIKE操作符</h3><p>用于在<code>WHERE</code>子句中搜索列中的指定模式</p>
<blockquote>
<p>SELECT column_name(s)</p>
<p>FROM table_name</p>
<p>WHERE column_name LIKE pattern</p>
</blockquote>
<p>Persons表：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>LastName</th>
<th>FirstName</th>
<th>Address</th>
<th>City</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Adams</td>
<td>John</td>
<td>Oxford Street</td>
<td>London</td>
</tr>
<tr>
<td>2</td>
<td>Bush</td>
<td>George</td>
<td>Fifth Avenue</td>
<td>New York</td>
</tr>
<tr>
<td>3</td>
<td>Carter</td>
<td>Thomas</td>
<td>Changan Street</td>
<td>Beijing</td>
</tr>
</tbody></table>
<p>例1：从上面的Persons表中选取居住在以”N”开始的城市里的人</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * </span><br><span class="line"><span class="keyword">FROM</span> Persons </span><br><span class="line"><span class="keyword">WHERE</span> City <span class="keyword">LIKE</span> <span class="string">'N%'</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Tips: “%”可用于定义通配符（模式中缺少的字母）</p>
</blockquote>
<p>结果：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>LastName</th>
<th>FirstName</th>
<th>Address</th>
<th>City</th>
</tr>
</thead>
<tbody><tr>
<td>2</td>
<td>Bush</td>
<td>George</td>
<td>Fifth Avenue</td>
<td>New York</td>
</tr>
</tbody></table>
<p>例2：从上面的Persons表中选取居住在以“g”结尾的城市里的人</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> Persons</span><br><span class="line"><span class="keyword">WHERE</span> City <span class="keyword">LIKE</span> <span class="string">'%g'</span></span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>LastName</th>
<th>FirstName</th>
<th>Address</th>
<th>City</th>
</tr>
</thead>
<tbody><tr>
<td>3</td>
<td>Carter</td>
<td>Thomas</td>
<td>Changan Street</td>
<td>Beijing</td>
</tr>
</tbody></table>
<p>例3：从上面的Persons表中选取居住在包含“lon”的城市里的人</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * </span><br><span class="line"><span class="keyword">FROM</span> Persons</span><br><span class="line"><span class="keyword">WHERE</span> City <span class="keyword">LIKE</span> <span class="string">'%lon%'</span></span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>LastName</th>
<th>FirstName</th>
<th>Address</th>
<th>City</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Adams</td>
<td>John</td>
<td>Oxford Street</td>
<td>London</td>
</tr>
</tbody></table>
<p>例4：通过使用关键字 <code>NOT</code>，我们可以从Persons表中选取居住在不包含‘lon’的城市里的人：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> Persons </span><br><span class="line"><span class="keyword">WHERE</span> City <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">'%lon%'</span></span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>LastName</th>
<th>FirstName</th>
<th>Address</th>
<th>City</th>
</tr>
</thead>
<tbody><tr>
<td>2</td>
<td>Bush</td>
<td>George</td>
<td>Fifth Avenue</td>
<td>New York</td>
</tr>
<tr>
<td>3</td>
<td>Carter</td>
<td>Thomas</td>
<td>Changan Street</td>
<td>Beijing</td>
</tr>
</tbody></table>
<h3 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h3><p>在搜索数据库中的数据是，SQL通配符可以代替一个或多个字符。</p>
<p>SQL通配符必须和<code>LIKE</code>运算符一起使用</p>
<p>在SQL中，可使用一下通配符：</p>
<table>
<thead>
<tr>
<th>通配符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>%</td>
<td>代替一个或多个字符</td>
</tr>
<tr>
<td>_</td>
<td>仅代替一个字符</td>
</tr>
<tr>
<td>[charlist]</td>
<td>字符列中的任何单一字符</td>
</tr>
<tr>
<td>[^charlist]  or [!charlist]</td>
<td>不在字符列中的任何单一字符</td>
</tr>
</tbody></table>
<p>原始Persons表：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>LastName</th>
<th>FirstName</th>
<th>Address</th>
<th>City</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Adams</td>
<td>John</td>
<td>Oxford Street</td>
<td>London</td>
</tr>
<tr>
<td>2</td>
<td>Bush</td>
<td>George</td>
<td>Fifth Avenue</td>
<td>New York</td>
</tr>
<tr>
<td>3</td>
<td>Carter</td>
<td>Thomas</td>
<td>Changan Street</td>
<td>Beijing</td>
</tr>
</tbody></table>
<p><strong><code>_</code>通配符：</strong></p>
<p>例1：我们希望从Persons表中选取名字的第一个字符之后是“eorge”的人：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> Persons </span><br><span class="line"><span class="keyword">WHERE</span> FirstName <span class="keyword">LIKE</span> <span class="string">'_eorge'</span></span><br></pre></td></tr></table></figure>

<p>同理：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * </span><br><span class="line"><span class="keyword">FROM</span> Persons </span><br><span class="line"><span class="keyword">WHERE</span> LastName <span class="keyword">LIKE</span> <span class="string">'C_r_er'</span></span><br></pre></td></tr></table></figure>

<p>就是寻找名字的姓氏以‘C’开头，然后是任意一个字符，然后是‘r’,然后任意字符，最后是’er’的人</p>
<p><code>[charlist]</code>字符集</p>
<p>例1：我们希望从上面的“Persons”表中选取居住的城市以‘A’或‘L’或’N‘开头的人</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> Persons</span><br><span class="line"><span class="keyword">WHERE</span> City <span class="keyword">LIKE</span> <span class="string">'[ALN]%'</span></span><br></pre></td></tr></table></figure>

<p>结果：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>LastName</th>
<th>FirstName</th>
<th>Address</th>
<th>City</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Adams</td>
<td>John</td>
<td>Oxford Street</td>
<td>London</td>
</tr>
<tr>
<td>2</td>
<td>Bush</td>
<td>George</td>
<td>Fifth Avenue</td>
<td>New York</td>
</tr>
</tbody></table>
<p>例2：从“Persons”表中选取居住城市不以‘A’或’L‘或’N‘开头的人：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> Persons</span><br><span class="line"><span class="keyword">WHERE</span> City <span class="keyword">LIKE</span> <span class="string">'[!ALN]%'</span></span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Mariana</p>
              <p class="site-description motion-element" itemprop="description">a study blog</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">122</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mariana</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
